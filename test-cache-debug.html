<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß TESTE SIMPLES: Cache Debug</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #00ff00; }
        .log { background: #000; padding: 10px; margin: 10px 0; border-left: 3px solid #00ff00; }
        .error { border-color: #ff0000; color: #ff0000; }
        .success { border-color: #00ff00; color: #00ff00; }
        .warning { border-color: #ffaa00; color: #ffaa00; }
        .info { border-color: #0088ff; color: #0088ff; }
        button { background: #333; color: #00ff00; border: 1px solid #555; padding: 10px; margin: 5px; cursor: pointer; }
        button:hover { background: #555; }
    </style>
</head>
<body>
    <h1>üîß TESTE SIMPLES: Cache Debug</h1>
    <p>Verificando se as fun√ß√µes de cache est√£o sendo carregadas corretamente...</p>
    
    <button onclick="checkFunctions()">üîç Verificar Fun√ß√µes</button>
    <button onclick="checkAudioAnalyzer()">üéµ Verificar AudioAnalyzer</button>
    <button onclick="forceDefine()">üîß For√ßar Defini√ß√£o</button>
    
    <div id="results"></div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const logDiv = document.createElement('div');
            logDiv.className = `log ${type}`;
            logDiv.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            results.appendChild(logDiv);
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function checkFunctions() {
            log('üîç Verificando fun√ß√µes de cache...', 'info');
            
            const functions = [
                'invalidateAudioAnalysisCache',
                'invalidateCacheByChange',
                '_cacheChangeMonitor',
                'NEW_CACHE_KEY'
            ];
            
            functions.forEach(fn => {
                const exists = window[fn] !== undefined;
                const type = typeof window[fn];
                log(`${exists ? '‚úÖ' : '‚ùå'} ${fn}: ${type}`, exists ? 'success' : 'error');
            });
        }

        function checkAudioAnalyzer() {
            log('üéµ Verificando AudioAnalyzer...', 'info');
            
            if (typeof AudioAnalyzer !== 'undefined') {
                log('‚úÖ AudioAnalyzer dispon√≠vel', 'success');
                log(`AudioAnalyzer type: ${typeof AudioAnalyzer}`, 'info');
            } else {
                log('‚ùå AudioAnalyzer n√£o encontrado', 'error');
            }
        }

        function forceDefine() {
            log('üîß For√ßando defini√ß√£o das fun√ß√µes...', 'warning');
            
            // Definir manualmente para teste
            if (!window.invalidateAudioAnalysisCache) {
                window.invalidateAudioAnalysisCache = function() {
                    log('üß™ Fun√ß√£o invalidateAudioAnalysisCache executada (teste)', 'info');
                    return { cleared: 0 };
                };
            }
            
            if (!window.invalidateCacheByChange) {
                window.invalidateCacheByChange = function(type, old, new_) {
                    log(`üß™ invalidateCacheByChange executada: ${type} ${old} -> ${new_}`, 'info');
                    return { cleared: 0 };
                };
            }
            
            if (!window._cacheChangeMonitor) {
                window._cacheChangeMonitor = {
                    checkAndInvalidate() {
                        log('üß™ _cacheChangeMonitor.checkAndInvalidate executado', 'info');
                    }
                };
            }
            
            log('‚úÖ Fun√ß√µes definidas manualmente', 'success');
            checkFunctions();
        }

        // Verifica√ß√£o inicial
        log('üöÄ P√°gina carregada', 'info');
        
        // Aguardar scripts carregarem
        setTimeout(() => {
            log('‚è∞ Verificando ap√≥s 2 segundos...', 'info');
            checkFunctions();
            checkAudioAnalyzer();
        }, 2000);
    </script>

    <!-- Carregar scripts ap√≥s a p√°gina -->
    <script src="refs/embedded-refs.js"></script>
    <script src="audio-analyzer.js"></script>
    
    <script>
        // Log quando scripts terminarem de carregar
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('üìÑ Scripts carregados, verificando novamente...', 'info');
                checkFunctions();
                checkAudioAnalyzer();
            }, 500);
        });
    </script>
</body>
</html>
