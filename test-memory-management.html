<!DOCTYPE html>
<html>
<head>
    <title>üö® TESTE CRITICAL MEMORY MANAGEMENT</title>
    <style>
        body { font-family: monospace; background: #1a1a1a; color: #00ff00; padding: 20px; }
        .status { padding: 10px; margin: 10px 0; border: 1px solid #333; }
        .success { background: #004400; border-color: #00ff00; }
        .error { background: #440000; border-color: #ff0000; color: #ff6666; }
        .info { background: #000044; border-color: #0066ff; color: #6666ff; }
    </style>
</head>
<body>
    <h1>üö® TESTE CR√çTICO: Memory Management</h1>
    <div id="status">üîÑ Iniciando testes...</div>
    
    <script>
        let statusDiv = document.getElementById('status');
        let logHTML = '';
        
        function log(msg, type = 'info') {
            console.log(msg);
            logHTML += `<div class="status ${type}">${msg}</div>`;
            statusDiv.innerHTML = logHTML;
        }
        
        // Fun√ß√£o para carregar script dinamicamente
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }
        
        async function runTest() {
            try {
                log('üîÑ Carregando audio-analyzer.js...', 'info');
                
                // Carregar com cache bust agressivo
                const cacheBust = Date.now();
                await loadScript(`audio-analyzer.js?cb=${cacheBust}`);
                
                // Aguardar um pouco para o script executar
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Verificar se AudioAnalyzer foi carregado
                if (typeof window.AudioAnalyzer === 'undefined') {
                    throw new Error('AudioAnalyzer n√£o foi carregado');
                }
                log('‚úÖ AudioAnalyzer carregado com sucesso!', 'success');
                
                // Verificar se a inst√¢ncia foi criada
                if (typeof window.audioAnalyzer === 'undefined') {
                    throw new Error('window.audioAnalyzer n√£o foi criado');
                }
                log('‚úÖ window.audioAnalyzer criado com sucesso!', 'success');
                
                // Verificar m√©todos de Memory Management
                const memoryMethods = Object.getOwnPropertyNames(window.AudioAnalyzer.prototype)
                    .filter(n => n.includes('Memory') || n.includes('cleanup') || n.includes('_forceGarbage'));
                
                if (memoryMethods.length === 0) {
                    throw new Error('M√©todos de Memory Management n√£o encontrados');
                }
                
                log(`‚úÖ Memory Management methods encontrados: ${memoryMethods.join(', ')}`, 'success');
                
                // Testar se os m√©todos existem na inst√¢ncia
                for (const method of memoryMethods) {
                    if (typeof window.audioAnalyzer[method] !== 'function') {
                        throw new Error(`M√©todo ${method} n√£o √© uma fun√ß√£o`);
                    }
                }
                log('‚úÖ Todos os m√©todos Memory Management s√£o fun√ß√µes v√°lidas!', 'success');
                
                // Teste de execu√ß√£o b√°sica (sem erro)
                try {
                    const memStats = window.audioAnalyzer._getMemoryStats();
                    log(`‚úÖ _getMemoryStats() executado: ${JSON.stringify(memStats)}`, 'success');
                } catch (e) {
                    log(`‚ö†Ô∏è _getMemoryStats() falhou: ${e.message}`, 'error');
                }
                
                log('üéâ PHASE 1 - MEMORY MANAGEMENT: SUCESSO TOTAL!', 'success');
                log('‚úÖ Sistema pronto para Phase 2 - Reference Manager', 'success');
                
            } catch (error) {
                log(`‚ùå ERRO CR√çTICO: ${error.message}`, 'error');
                log(`‚ùå Stack: ${error.stack}`, 'error');
            }
        }
        
        // Executar teste
        runTest();
    </script>
</body>
</html>
