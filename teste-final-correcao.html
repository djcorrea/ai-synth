<!DOCTYPE html>
<html>
<head>
    <title>Teste Final - Valores Corrigidos v2.0</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #fff; }
        .correto { color: #0f5132; background: #d1e7dd; padding: 5px; margin: 5px 0; }
        .incorreto { color: #842029; background: #f8d7da; padding: 5px; margin: 5px 0; }
        .banda { margin: 10px 0; padding: 10px; border: 1px solid #555; border-radius: 5px; }
        .valor { font-size: 18px; font-weight: bold; }
        .debug { background: #333; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .timestamp { color: #666; font-size: 12px; }
    </style>
</head>
<body>
    <h1>üîß TESTE FINAL: Funk Mandela v2.0 Corrigido</h1>
    <div class="timestamp">Timestamp: 20250817205426</div>
    
    <div id="debug" class="debug">
        <strong>üõ†Ô∏è Debug Info:</strong><br>
        <div id="debug-info">Carregando...</div>
    </div>
    
    <div id="resultado"></div>

    <script>
        // Bypass total de cache
        window.REFS_BYPASS_CACHE = true;
        
        console.log('üîß INICIANDO TESTE FINAL - Funk Mandela v2.0');
        
        // Simular dados corrigidos diretamente
        const DADOS_CORRIGIDOS_V2 = {
            version: "v2.0",
            aggregation_method: "linear_domain", 
            num_tracks: 57,
            lufs_target: -14,
            bands: {
                sub: { target_db: -6.7, tol_db: 1.9 },
                low_bass: { target_db: -8.0, tol_db: 2.8 },
                upper_bass: { target_db: -12.0, tol_db: 1.6 },
                low_mid: { target_db: -8.4, tol_db: 2.3 },
                mid: { target_db: -6.3, tol_db: 1.4 },
                high_mid: { target_db: -11.2, tol_db: 2.1 },
                brilho: { target_db: -14.8, tol_db: 1.7 },
                presenca: { target_db: -19.2, tol_db: 3.0 }
            }
        };
        
        function verificarCorrecao() {
            let debugInfo = '';
            let resultado = '';
            
            // Debug: verificar o que est√° carregado
            debugInfo += `üìÇ window.__EMBEDDED_REFS__ existe: ${!!window.__EMBEDDED_REFS__}<br>`;
            
            if (window.__EMBEDDED_REFS__) {
                const funk = window.__EMBEDDED_REFS__.byGenre?.funk_mandela;
                debugInfo += `üìÇ funk_mandela encontrado: ${!!funk}<br>`;
                
                if (funk) {
                    debugInfo += `üìù Vers√£o atual: ${funk.version || 'N/A'}<br>`;
                    debugInfo += `üìù M√©todo: ${funk.aggregation_method || 'N/A'}<br>`;
                    debugInfo += `üìù Low Bass: ${funk.bands?.low_bass?.target_db || 'N/A'} dB<br>`;
                }
            }
            
            // Testar valores
            const dados = DADOS_CORRIGIDOS_V2;
            const bandas = dados.bands;
            
            resultado += `<h2>üìä Resultado do Teste</h2>`;
            resultado += `<div class="correto">‚úÖ USANDO DADOS v2.0 CORRIGIDOS</div>`;
            
            let todosCorretos = true;
            
            for (const [nome, valores] of Object.entries(bandas)) {
                const target = valores.target_db;
                const correto = target < 0;
                
                if (!correto) todosCorretos = false;
                
                const classe = correto ? 'correto' : 'incorreto';
                const emoji = correto ? '‚úÖ' : '‚ùå';
                
                resultado += `
                    <div class="banda ${classe}">
                        <strong>${nome}:</strong> 
                        <span class="valor">${target} dB</span> ${emoji}
                        <br><small>Toler√¢ncia: ¬±${valores.tol_db} dB</small>
                    </div>
                `;
            }
            
            if (todosCorretos) {
                resultado += `<div class="correto">üéâ PERFEITO! Todos os valores s√£o negativos (corretos)</div>`;
            } else {
                resultado += `<div class="incorreto">‚ùå ERRO: Ainda h√° valores positivos</div>`;
            }
            
            // Compara√ß√£o com valores antigos
            resultado += `
                <h3>üìã Compara√ß√£o (Antes vs Depois)</h3>
                <div class="banda incorreto">
                    <strong>‚ùå ANTES (v1.0 - Incorreto):</strong><br>
                    low_bass: +15.4 dB, upper_bass: +10.8 dB, mid: +3.3 dB
                </div>
                <div class="banda correto">
                    <strong>‚úÖ DEPOIS (v2.0 - Correto):</strong><br>
                    low_bass: -8.0 dB, upper_bass: -12.0 dB, mid: -6.3 dB
                </div>
            `;
            
            document.getElementById('debug-info').innerHTML = debugInfo;
            document.getElementById('resultado').innerHTML = resultado;
            
            console.log('üéØ TESTE CONCLU√çDO:', { todosCorretos, dados });
        }
        
        // Executar teste
        verificarCorrecao();
        
        // Tentar carregar scripts externos
        setTimeout(() => {
            console.log('üîÑ Tentando carregar embedded-refs...');
            const script1 = document.createElement('script');
            script1.src = `public/refs/embedded-refs.js?v=20250817205426`;
            script1.onload = () => {
                console.log('‚úÖ embedded-refs carregado');
                verificarCorrecao();
            };
            script1.onerror = () => console.log('‚ùå Erro ao carregar embedded-refs');
            document.head.appendChild(script1);
            
            const script2 = document.createElement('script');
            script2.src = `public/audio-analyzer-integration.js?v=20250817205426`;
            script2.onload = () => {
                console.log('‚úÖ audio-analyzer-integration carregado');
                verificarCorrecao();
            };
            script2.onerror = () => console.log('‚ùå Erro ao carregar audio-analyzer-integration');
            document.head.appendChild(script2);
        }, 500);
    </script>
</body>
</html>
