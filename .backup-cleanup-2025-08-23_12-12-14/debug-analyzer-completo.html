<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêõ DEBUG COMPLETO - Sistema de An√°lise de √Åudio</title>
    <style>
        body { 
            font-family: monospace; 
            background: #1a1a1a; 
            color: #fff; 
            margin: 20px; 
            line-height: 1.6;
        }
        .debug-section { 
            background: #2a2a2a; 
            padding: 20px; 
            margin: 20px 0; 
            border-radius: 8px;
            border: 1px solid #444;
        }
        .debug-title { 
            color: #00ff88; 
            font-size: 18px; 
            font-weight: bold; 
            margin-bottom: 15px;
        }
        .metric-row { 
            display: flex; 
            justify-content: space-between; 
            padding: 8px; 
            margin: 4px 0;
            background: #333;
            border-radius: 4px;
        }
        .metric-label { color: #aaa; }
        .metric-value { color: #fff; font-weight: bold; }
        .metric-issue { color: #ff4444; }
        .metric-ok { color: #44ff44; }
        .debug-button { 
            background: #0066cc; 
            color: white; 
            border: none; 
            padding: 12px 20px; 
            margin: 10px 5px; 
            border-radius: 6px; 
            cursor: pointer;
            font-size: 14px;
        }
        .debug-button:hover { background: #0088ff; }
        .debug-output { 
            background: #1e1e1e; 
            border: 1px solid #444; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 6px; 
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .logs { 
            white-space: pre-wrap; 
            font-family: 'Courier New', monospace;
        }
        .error { color: #ff6666; }
        .warning { color: #ffaa66; }
        .info { color: #66aaff; }
        .success { color: #66ff66; }
    </style>
</head>
<body>
    <h1>üêõ DEBUG COMPLETO - Analisador de √Åudio</h1>
    <p>Debug sistem√°tico para identificar os problemas mencionados:</p>
    
    <!-- Controles de Debug -->
    <div class="debug-section">
        <div class="debug-title">üîß Controles de Debug</div>
        <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px;">
            <button class="debug-button" onclick="enableDebug()">‚úÖ Ativar Debug Detalhado</button>
            <button class="debug-button" onclick="disableDebug()">‚ùå Desativar Debug</button>
            <button class="debug-button" onclick="checkDebugStatus()">üìä Status do Sistema</button>
            <button class="debug-button" onclick="clearDebugLogs()">üóëÔ∏è Limpar Logs</button>
        </div>
        
        <div style="margin: 15px 0;">
            <div class="debug-title" style="font-size: 16px; margin-bottom: 10px;">üéØ Debug Espec√≠fico por Problema:</div>
            <div style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 10px;">
                <label style="color: #aaa;"><input type="checkbox" id="debug-lufs" checked style="margin-right: 5px;"> LUFS Duplica√ß√£o</label>
                <label style="color: #aaa;"><input type="checkbox" id="debug-dynamics" checked style="margin-right: 5px;"> Din√¢mica Negativa</label>
                <label style="color: #aaa;"><input type="checkbox" id="debug-clipping" checked style="margin-right: 5px;"> Contradi√ß√£o Clipping</label>
                <label style="color: #aaa;"><input type="checkbox" id="debug-score" checked style="margin-right: 5px;"> Score T√©cnico Zero</label>
                <label style="color: #aaa;"><input type="checkbox" id="debug-mono" checked style="margin-right: 5px;"> Mono Compatibility</label>
            </div>
            <button class="debug-button" onclick="enableSpecificDebug()">üéØ Ativar Debug Espec√≠fico</button>
        </div>
        
        <div id="debug-status" style="background: #333; padding: 10px; border-radius: 4px; font-size: 12px; color: #aaa;">
            <em>Status do debug ser√° exibido aqui...</em>
        </div>
    </div>
    
    <!-- Upload de arquivo para teste -->
    <div class="debug-section">
        <div class="debug-title">üìÅ Upload de √Åudio para Teste</div>
        <input type="file" id="audioFile" accept="audio/*" style="margin: 10px 0; padding: 10px; background: #333; color: #fff; border: 1px solid #666; border-radius: 4px;">
        <button class="debug-button" onclick="analisarArquivo()">üîç Analisar Arquivo</button>
        <button class="debug-button" onclick="ativarFase5()">üîß Ativar Fase 5</button>
        <button class="debug-button" onclick="verificarCorre√ß√µes()">üìä Ver Corre√ß√µes</button>
    </div>

    <!-- Resultados da an√°lise -->
    <div class="debug-section">
        <div class="debug-title">üìä Resultados da An√°lise</div>
        <div id="resultadosAnalise" class="debug-output">
            <em>Nenhuma an√°lise realizada ainda...</em>
        </div>
    </div>

    <!-- LUFS espec√≠fico -->
    <div class="debug-section">
        <div class="debug-title">üéµ LUFS - Diagn√≥stico de Duplica√ß√£o</div>
        <div id="lufsDebug" class="debug-output">
            <em>Aguardando an√°lise...</em>
        </div>
    </div>

    <!-- Din√¢mica espec√≠fico -->
    <div class="debug-section">
        <div class="debug-title">üìà Din√¢mica - Diagn√≥stico de Valores Negativos</div>
        <div id="dinamicaDebug" class="debug-output">
            <em>Aguardando an√°lise...</em>
        </div>
    </div>

    <!-- True Peak e Clipping -->
    <div class="debug-section">
        <div class="debug-title">üîä True Peak & Clipping - Diagn√≥stico de Contradi√ß√µes</div>
        <div id="clippingDebug" class="debug-output">
            <em>Aguardando an√°lise...</em>
        </div>
    </div>

    <!-- Score T√©cnico -->
    <div class="debug-section">
        <div class="debug-title">üèÜ Score T√©cnico - Diagn√≥stico do C√°lculo</div>
        <div id="scoreDebug" class="debug-output">
            <em>Aguardando an√°lise...</em>
        </div>
    </div>

    <!-- Mono Compatibility -->
    <div class="debug-section">
        <div class="debug-title">üéß Mono Compatibility - Diagn√≥stico da Correla√ß√£o</div>
        <div id="monoDebug" class="debug-output">
            <em>Aguardando an√°lise...</em>
        </div>
    </div>

    <!-- Logs gerais -->
    <div class="debug-section">
        <div class="debug-title">üìã Logs do Sistema</div>
        <div id="logsGerais" class="debug-output logs">
            <em>Logs aparecer√£o aqui...</em>
        </div>
    </div>

    <script>
        // Sistema de logs centralizados
        const logs = [];
        function addLog(type, message, data = null) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = { type, message, data, timestamp };
            logs.push(logEntry);
            
            const logsEl = document.getElementById('logsGerais');
            const className = type === 'error' ? 'error' : 
                             type === 'warning' ? 'warning' : 
                             type === 'success' ? 'success' : 'info';
            
            const dataStr = data ? ` | DATA: ${JSON.stringify(data, null, 2)}` : '';
            logsEl.innerHTML += `<span class="${className}">[${timestamp}] ${type.toUpperCase()}: ${message}${dataStr}</span>\n`;
            logsEl.scrollTop = logsEl.scrollHeight;
        }

        // Vari√°veis globais para debug
        let analiseAtual = null;
        let analyzer = null;

        // Fun√ß√£o para ativar Fase 5
        function ativarFase5() {
            window.ENABLE_PHASE5_CRITICAL_FIXES = true;
            addLog('success', 'Fase 5 ativada: window.ENABLE_PHASE5_CRITICAL_FIXES = true');
        }

        // Fun√ß√£o para verificar corre√ß√µes aplicadas
        function verificarCorre√ß√µes() {
            if (typeof window.getPhase5Corrections === 'function') {
                const corrections = window.getPhase5Corrections();
                addLog('info', 'Corre√ß√µes da Fase 5', corrections);
                
                const correcContainer = document.getElementById('resultadosAnalise');
                correcContainer.innerHTML += `
                    <div style="border: 1px solid #666; padding: 10px; margin: 10px 0; border-radius: 4px;">
                        <strong>üìä Corre√ß√µes da Fase 5:</strong><br>
                        <pre>${JSON.stringify(corrections, null, 2)}</pre>
                    </div>
                `;
            } else {
                addLog('warning', 'Fun√ß√£o getPhase5Corrections n√£o dispon√≠vel');
            }

            if (typeof window.getCompleteAudit === 'function') {
                const audit = window.getCompleteAudit();
                addLog('info', 'Auditoria completa', audit);
            }
        }

        // Fun√ß√£o principal de an√°lise
        async function analisarArquivo() {
            const fileInput = document.getElementById('audioFile');
            if (!fileInput.files.length) {
                addLog('error', 'Nenhum arquivo selecionado');
                return;
            }

            const file = fileInput.files[0];
            addLog('info', `Iniciando an√°lise do arquivo: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`);

            try {
                // Carregar analyzer se necess√°rio
                if (!analyzer) {
                    addLog('info', 'Carregando AudioAnalyzer...');
                    
                    // Carregar scripts se necess√°rio
                    await carregarScripts();
                    
                    if (typeof AudioAnalyzer !== 'undefined') {
                        analyzer = new AudioAnalyzer();
                        addLog('success', 'AudioAnalyzer carregado com sucesso');
                    } else {
                        addLog('error', 'AudioAnalyzer n√£o encontrado ap√≥s carregamento');
                        return;
                    }
                }

                // Realizar an√°lise
                addLog('info', 'Executando an√°lise de √°udio...');
                analiseAtual = await analyzer.analyzeAudioFile(file);
                
                addLog('success', 'An√°lise conclu√≠da');
                
                // Exibir resultados estruturados
                exibirResultados(analiseAtual);
                
                // Debug espec√≠fico de cada problema
                debugLUFS(analiseAtual);
                debugDinamica(analiseAtual);
                debugClipping(analiseAtual);
                debugScore(analiseAtual);
                debugMono(analiseAtual);

            } catch (error) {
                addLog('error', `Erro durante an√°lise: ${error.message}`, error);
            }
        }

        // Carregar scripts necess√°rios
        async function carregarScripts() {
            const scripts = [
                'audio-analyzer.js',
                'audio-analyzer-integration.js',
                'enable-audit.js'
            ];

            for (const script of scripts) {
                if (!document.querySelector(`script[src*="${script}"]`)) {
                    addLog('info', `Carregando ${script}...`);
                    await new Promise((resolve, reject) => {
                        const s = document.createElement('script');
                        s.src = script;
                        s.onload = () => {
                            addLog('success', `${script} carregado`);
                            resolve();
                        };
                        s.onerror = () => {
                            addLog('error', `Falha ao carregar ${script}`);
                            reject();
                        };
                        document.head.appendChild(s);
                    });
                }
            }
        }

        // Exibir resultados estruturados
        function exibirResultados(analise) {
            const container = document.getElementById('resultadosAnalise');
            const td = analise.technicalData || {};
            
            container.innerHTML = `
                <div class="metric-row">
                    <span class="metric-label">Arquivo:</span>
                    <span class="metric-value">${analise.fileName || 'N/A'}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Duration:</span>
                    <span class="metric-value">${analise.duration ? analise.duration.toFixed(2) + 's' : 'N/A'}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Sample Rate:</span>
                    <span class="metric-value">${analise.sampleRate || 'N/A'} Hz</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Channels:</span>
                    <span class="metric-value">${analise.channels || 'N/A'}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Score Geral:</span>
                    <span class="metric-value ${analise.qualityOverall ? 'metric-ok' : 'metric-issue'}">${analise.qualityOverall || 'N/A'}/100</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Problemas:</span>
                    <span class="metric-value">${(analise.problems || []).length}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Sugest√µes:</span>
                    <span class="metric-value">${(analise.suggestions || []).length}</span>
                </div>
                
                <hr style="margin: 15px 0; border: 1px solid #444;">
                <h4>üìä Dados T√©cnicos Brutos:</h4>
                <pre style="font-size: 11px; color: #ccc; white-space: pre-wrap; max-height: 300px; overflow-y: auto;">${JSON.stringify(td, null, 2)}</pre>
            `;
        }

        // Debug espec√≠fico para LUFS
        function debugLUFS(analise) {
            const container = document.getElementById('lufsDebug');
            const td = analise.technicalData || {};
            
            const lufsValues = {
                'LUFS Integrado': td.lufsIntegrated,
                'LUFS Short-Term': td.lufsShortTerm,
                'LUFS Momentary': td.lufsMomentary,
                'RMS': td.rms,
                'Peak': td.peak,
                'True Peak': td.truePeakDbtp
            };

            let html = '<h4>üîç Todos os valores de volume encontrados:</h4>';
            
            for (const [label, value] of Object.entries(lufsValues)) {
                const hasValue = Number.isFinite(value);
                const className = hasValue ? 'metric-ok' : 'metric-issue';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">${label}:</span>
                        <span class="metric-value ${className}">${hasValue ? value.toFixed(2) : 'N/A'}</span>
                    </div>
                `;
            }

            // Verificar se h√° duplica√ß√£o
            const valoresDefinidos = Object.entries(lufsValues)
                .filter(([k, v]) => Number.isFinite(v))
                .map(([k, v]) => ({ label: k, value: v }));

            if (valoresDefinidos.length > 1) {
                html += '<h4>‚ö†Ô∏è An√°lise de Duplica√ß√£o:</h4>';
                
                // Comparar LUFS entre si
                const lufsOnly = valoresDefinidos.filter(v => v.label.includes('LUFS'));
                if (lufsOnly.length > 1) {
                    html += '<div style="color: #ffaa66;">M√öLTIPLOS VALORES LUFS DETECTADOS:</div>';
                    lufsOnly.forEach(l => {
                        html += `<div>- ${l.label}: ${l.value.toFixed(2)} LUFS</div>`;
                    });
                    
                    // Calcular diverg√™ncia m√°xima
                    const valores = lufsOnly.map(l => l.value);
                    const min = Math.min(...valores);
                    const max = Math.max(...valores);
                    const divergencia = max - min;
                    
                    html += `<div style="color: ${divergencia > 1 ? '#ff4444' : '#44ff44'};">Diverg√™ncia m√°xima: ${divergencia.toFixed(2)} dB</div>`;
                }
            }

            container.innerHTML = html;
        }

        // Debug espec√≠fico para Din√¢mica
        function debugDinamica(analise) {
            const container = document.getElementById('dinamicaDebug');
            const td = analise.technicalData || {};
            
            const dynamicValues = {
                'Dynamic Range (DR)': td.dynamicRange,
                'LRA': td.lra,
                'Crest Factor': td.crestFactor
            };

            let html = '<h4>üîç Valores de din√¢mica encontrados:</h4>';
            
            for (const [label, value] of Object.entries(dynamicValues)) {
                const hasValue = Number.isFinite(value);
                const isNegative = hasValue && value < 0;
                const className = !hasValue ? 'metric-issue' : isNegative ? 'error' : 'metric-ok';
                
                html += `
                    <div class="metric-row">
                        <span class="metric-label">${label}:</span>
                        <span class="metric-value ${className}">
                            ${hasValue ? value.toFixed(2) : 'N/A'}
                            ${isNegative ? ' ‚ö†Ô∏è VALOR IMPOSS√çVEL' : ''}
                        </span>
                    </div>
                `;
            }

            // Verificar valores imposs√≠veis
            const valoresNegativos = Object.entries(dynamicValues)
                .filter(([k, v]) => Number.isFinite(v) && v < 0);

            if (valoresNegativos.length > 0) {
                html += '<div style="color: #ff4444; margin-top: 15px;">üö® VALORES IMPOSS√çVEIS DETECTADOS:</div>';
                valoresNegativos.forEach(([label, value]) => {
                    html += `<div>- ${label}: ${value.toFixed(2)} (din√¢mica n√£o pode ser negativa)</div>`;
                });
            }

            container.innerHTML = html;
        }

        // Debug espec√≠fico para Clipping
        function debugClipping(analise) {
            const container = document.getElementById('clippingDebug');
            const td = analise.technicalData || {};
            
            const clippingData = {
                'True Peak': { value: td.truePeakDbtp, unit: 'dBTP' },
                'Sample Peak': { value: td.peak, unit: 'dB' },
                'Clipping Samples': { value: td.clippingSamples, unit: 'samples' },
                'Clipping %': { value: td.clippingPct, unit: '%' }
            };

            let html = '<h4>üîç Dados de clipping e picos:</h4>';
            
            for (const [label, data] of Object.entries(clippingData)) {
                const hasValue = Number.isFinite(data.value);
                const className = hasValue ? 'metric-ok' : 'metric-issue';
                
                html += `
                    <div class="metric-row">
                        <span class="metric-label">${label}:</span>
                        <span class="metric-value ${className}">
                            ${hasValue ? data.value.toFixed(2) + ' ' + data.unit : 'N/A'}
                        </span>
                    </div>
                `;
            }

            // Analisar contradi√ß√µes
            const truePeak = td.truePeakDbtp;
            const clippingSamples = td.clippingSamples || 0;
            const hasClipping = clippingSamples > 0;
            const peakAlto = Number.isFinite(truePeak) && truePeak > -0.5;

            html += '<h4>‚öñÔ∏è An√°lise de Consist√™ncia:</h4>';
            
            if (hasClipping && !peakAlto) {
                html += '<div style="color: #ff4444;">üö® CONTRADI√á√ÉO: H√° clipping mas True Peak n√£o indica perigo</div>';
            } else if (!hasClipping && peakAlto) {
                html += '<div style="color: #ffaa66;">‚ö†Ô∏è POSS√çVEL INCONSIST√äNCIA: True Peak alto mas sem clipping detectado</div>';
            } else {
                html += '<div style="color: #44ff44;">‚úÖ Dados consistentes entre clipping e True Peak</div>';
            }

            // Verificar sugest√µes contradit√≥rias
            const suggestions = analise.suggestions || [];
            const suggestionsText = suggestions.map(s => s.action || s.message || '').join(' ').toLowerCase();
            
            if (hasClipping || peakAlto) {
                if (suggestionsText.includes('aumentar') || suggestionsText.includes('boost') || suggestionsText.includes('+')) {
                    html += '<div style="color: #ff4444;">üö® SUGEST√ÉO CONTRADIT√ìRIA: Sistema sugere aumento apesar do clipping</div>';
                } else {
                    html += '<div style="color: #44ff44;">‚úÖ Sugest√µes consistentes com situa√ß√£o de clipping</div>';
                }
            }

            container.innerHTML = html;
        }

        // Debug espec√≠fico para Score
        function debugScore(analise) {
            const container = document.getElementById('scoreDebug');
            
            const scores = {
                'Score Geral': analise.qualityOverall,
                'Mix Score': analise.mixScore,
                'Mix Score %': analise.mixScorePct
            };

            let html = '<h4>üîç Scores encontrados:</h4>';
            
            for (const [label, value] of Object.entries(scores)) {
                const hasValue = Number.isFinite(value);
                const isZero = hasValue && value === 0;
                const className = !hasValue ? 'metric-issue' : isZero ? 'warning' : 'metric-ok';
                
                html += `
                    <div class="metric-row">
                        <span class="metric-label">${label}:</span>
                        <span class="metric-value ${className}">
                            ${hasValue ? value : 'N/A'}
                            ${isZero ? ' ‚ö†Ô∏è SEMPRE ZERO' : ''}
                        </span>
                    </div>
                `;
            }

            // Verificar breakdown de scores
            if (analise.qualityBreakdown) {
                html += '<h4>üìä Breakdown de Scores:</h4>';
                for (const [key, value] of Object.entries(analise.qualityBreakdown)) {
                    const hasValue = Number.isFinite(value);
                    const className = hasValue ? 'metric-ok' : 'metric-issue';
                    html += `
                        <div class="metric-row">
                            <span class="metric-label">${key}:</span>
                            <span class="metric-value ${className}">${hasValue ? value : 'N/A'}</span>
                        </div>
                    `;
                }
            }

            // Verificar se h√° dados suficientes para calcular score
            const td = analise.technicalData || {};
            const metricsAvailable = {
                'LUFS': Number.isFinite(td.lufsIntegrated),
                'True Peak': Number.isFinite(td.truePeakDbtp),
                'LRA': Number.isFinite(td.lra),
                'Stereo Correlation': Number.isFinite(td.stereoCorrelation)
            };

            html += '<h4>üîß M√©tricas dispon√≠veis para c√°lculo:</h4>';
            for (const [metric, available] of Object.entries(metricsAvailable)) {
                html += `
                    <div class="metric-row">
                        <span class="metric-label">${metric}:</span>
                        <span class="metric-value ${available ? 'metric-ok' : 'metric-issue'}">${available ? '‚úÖ Dispon√≠vel' : '‚ùå Indispon√≠vel'}</span>
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        // Debug espec√≠fico para Mono
        function debugMono(analise) {
            const container = document.getElementById('monoDebug');
            const td = analise.technicalData || {};
            
            const monoData = {
                'Mono Compatibility': td.monoCompatibility,
                'Stereo Correlation': td.stereoCorrelation,
                'Stereo Width': td.stereoWidth,
                'Balance L/R': td.balanceLR
            };

            let html = '<h4>üîç Dados de est√©reo/mono:</h4>';
            
            for (const [label, value] of Object.entries(monoData)) {
                const hasValue = (label === 'Mono Compatibility') ? 
                    (value && value !== '') : Number.isFinite(value);
                const className = hasValue ? 'metric-ok' : 'metric-issue';
                
                let displayValue = value;
                if (label === 'Mono Compatibility') {
                    displayValue = value || 'N/A';
                } else if (hasValue) {
                    displayValue = value.toFixed(3);
                } else {
                    displayValue = 'N/A';
                }
                
                html += `
                    <div class="metric-row">
                        <span class="metric-label">${label}:</span>
                        <span class="metric-value ${className}">${displayValue}</span>
                    </div>
                `;
            }

            // Analisar consist√™ncia
            const correlation = td.stereoCorrelation;
            const monoCompat = td.monoCompatibility;
            
            if (Number.isFinite(correlation) && monoCompat) {
                html += '<h4>‚öñÔ∏è An√°lise de Consist√™ncia:</h4>';
                
                // Determinar o que deveria ser baseado na correla√ß√£o
                let expectedMono;
                if (correlation < 0.1) expectedMono = 'Poor';
                else if (correlation < 0.3) expectedMono = 'Fair';
                else if (correlation < 0.6) expectedMono = 'Good';
                else if (correlation < 0.85) expectedMono = 'Very Good';
                else expectedMono = 'Excellent';
                
                const currentMono = monoCompat.replace(/\s*\(.*\)/, ''); // Remove texto explicativo
                
                if (currentMono.toLowerCase().includes('poor') && correlation > 0.3) {
                    html += `<div style="color: #ff4444;">üö® INCONSIST√äNCIA: Mono = "${monoCompat}" mas correla√ß√£o = ${correlation.toFixed(3)} (deveria ser "${expectedMono}")</div>`;
                } else {
                    html += `<div style="color: #44ff44;">‚úÖ Consistente: Mono = "${monoCompat}" com correla√ß√£o = ${correlation.toFixed(3)}</div>`;
                }
                
                html += `<div>Correla√ß√£o ${correlation.toFixed(3)} deveria resultar em: <strong>${expectedMono}</strong></div>`;
            }

            container.innerHTML = html;
        }

        // üîß FUN√á√ïES DE CONTROLE DE DEBUG
        function enableDebug() {
            // Carregar enable-audit.js se ainda n√£o foi carregado
            if (!window.enableDetailedDebug) {
                const script = document.createElement('script');
                script.src = '/enable-audit.js';
                script.onload = function() {
                    const result = window.enableDetailedDebug();
                    updateDebugStatus(`Debug ativado √†s ${result.timestamp}`);
                    addLog('success', 'üêõ Debug detalhado ATIVADO - Todas as fun√ß√µes habilitadas');
                };
                document.head.appendChild(script);
            } else {
                const result = window.enableDetailedDebug();
                updateDebugStatus(`Debug ativado √†s ${result.timestamp}`);
                addLog('success', 'üêõ Debug detalhado ATIVADO');
            }
        }

        function disableDebug() {
            if (window.disableDetailedDebug) {
                const result = window.disableDetailedDebug();
                updateDebugStatus(`Debug desativado √†s ${result.timestamp}`);
                addLog('info', 'üîá Debug detalhado DESATIVADO');
            } else {
                addLog('warning', '‚ö†Ô∏è Sistema de debug n√£o est√° carregado');
            }
        }

        function checkDebugStatus() {
            if (window.getDebugStatus) {
                const status = window.getDebugStatus();
                updateDebugStatus(`
                    <strong>Status atual:</strong><br>
                    Debug detalhado: ${status.detailedDebug ? '‚úÖ Ativo' : '‚ùå Inativo'}<br>
                    Analyzer debug: ${status.analyzerDebug ? '‚úÖ Ativo' : '‚ùå Inativo'}<br>
                    Audit logs: ${status.auditLogs ? '‚úÖ Ativo' : '‚ùå Inativo'}<br>
                    Fase 5 cr√≠tica: ${status.phase5Critical ? '‚úÖ Ativo' : '‚ùå Inativo'}
                `);
                addLog('info', 'üìä Status do debug verificado - veja a se√ß√£o de controles');
            } else {
                updateDebugStatus('Sistema de debug n√£o carregado');
                addLog('warning', '‚ö†Ô∏è Sistema de debug n√£o est√° dispon√≠vel');
            }
        }

        function enableSpecificDebug() {
            const problems = [];
            
            if (document.getElementById('debug-lufs').checked) problems.push('lufs');
            if (document.getElementById('debug-dynamics').checked) problems.push('dynamics');
            if (document.getElementById('debug-clipping').checked) problems.push('clipping');
            if (document.getElementById('debug-score').checked) problems.push('score');
            if (document.getElementById('debug-mono').checked) problems.push('mono');
            
            if (window.enableSpecificDebug) {
                const result = window.enableSpecificDebug(problems);
                updateDebugStatus(`Debug espec√≠fico ativo para: ${result.enabled.join(', ')}`);
                addLog('success', `üéØ Debug espec√≠fico ativado para ${result.enabled.length} problemas`);
            } else {
                addLog('warning', '‚ö†Ô∏è Sistema de debug espec√≠fico n√£o dispon√≠vel - ativando debug geral...');
                enableDebug();
            }
        }

        function clearDebugLogs() {
            if (window.clearAuditResults) {
                window.clearAuditResults();
                addLog('info', 'üóëÔ∏è Cache de auditoria limpo');
            }
            
            // Limpar logs visuais
            const debugSections = ['resultadosAnalise', 'lufsDebug', 'dinamicaDebug', 'clippingDebug', 'scoreDebug', 'monoDebug'];
            debugSections.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.innerHTML = '<em>Logs limpos...</em>';
                }
            });
            
            updateDebugStatus('Logs limpos');
            addLog('info', 'üßπ Interface de debug limpa');
        }

        function updateDebugStatus(message) {
            const statusElement = document.getElementById('debug-status');
            if (statusElement) {
                statusElement.innerHTML = `<strong>Status:</strong> ${message}`;
            }
        }

        // Inicializa√ß√£o
        addLog('info', 'Sistema de debug inicializado');
        addLog('info', 'Upload um arquivo de √°udio e clique em "Analisar" para come√ßar');
    </script>
</body>
</html>
