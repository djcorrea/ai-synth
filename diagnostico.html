<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>üîß Diagn√≥stico AudioAnalyzer</title>
    <style>
        body { 
            font-family: monospace; 
            background: #1a1a1a; 
            color: #e0e0e0; 
            padding: 20px; 
        }
        .log { 
            background: #2d2d2d; 
            padding: 15px; 
            border-radius: 8px; 
            margin: 10px 0; 
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .info { color: #3b82f6; }
    </style>
</head>
<body>
    <h1>üîß Diagn√≥stico AudioAnalyzer</h1>
    <div id="output"></div>

    <script>
        const output = document.getElementById('output');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            output.appendChild(div);
        }
        
        async function diagnosticar() {
            log('üîç Iniciando diagn√≥stico...', 'info');
            
            // 1. Verificar se conseguimos fazer fetch do arquivo
            try {
                const response = await fetch('./public/audio-analyzer.js');
                if (response.ok) {
                    log('‚úÖ Fetch do arquivo OK', 'success');
                    const content = await response.text();
                    log(`üìÑ Tamanho do arquivo: ${content.length} caracteres`, 'info');
                    
                    // Verificar se cont√©m a classe
                    if (content.includes('class AudioAnalyzer')) {
                        log('‚úÖ Classe AudioAnalyzer encontrada no arquivo', 'success');
                    } else {
                        log('‚ùå Classe AudioAnalyzer N√ÉO encontrada', 'error');
                    }
                    
                    // Verificar se cont√©m window.AudioAnalyzer
                    if (content.includes('window.AudioAnalyzer')) {
                        log('‚úÖ window.AudioAnalyzer encontrado no arquivo', 'success');
                    } else {
                        log('‚ùå window.AudioAnalyzer N√ÉO encontrado', 'error');
                    }
                    
                } else {
                    log(`‚ùå Fetch falhou: ${response.status}`, 'error');
                }
            } catch (e) {
                log(`‚ùå Erro no fetch: ${e.message}`, 'error');
            }
            
            // 2. Tentar carregar via script tag
            log('üîÑ Tentando carregar via script tag...', 'info');
            
            const script = document.createElement('script');
            script.src = './public/audio-analyzer.js';
            
            script.onload = () => {
                log('‚úÖ Script carregado com sucesso', 'success');
                
                // Verificar se AudioAnalyzer est√° dispon√≠vel
                if (typeof window.AudioAnalyzer === 'function') {
                    log('‚úÖ window.AudioAnalyzer √© uma fun√ß√£o', 'success');
                    
                    try {
                        const analyzer = new window.AudioAnalyzer();
                        log('‚úÖ AudioAnalyzer instanciado com sucesso', 'success');
                        
                        // Verificar m√©todos
                        const methods = ['_cleanupAudioBuffer', '_cleanupStemsArrays', '_cleanupLRUCache'];
                        methods.forEach(method => {
                            if (typeof analyzer[method] === 'function') {
                                log(`‚úÖ ${method} dispon√≠vel`, 'success');
                            } else {
                                log(`‚ùå ${method} N√ÉO dispon√≠vel`, 'error');
                            }
                        });
                        
                        log('üéâ DIAGN√ìSTICO CONCLU√çDO: AudioAnalyzer funcionando!', 'success');
                        
                    } catch (e) {
                        log(`‚ùå Erro ao instanciar: ${e.message}`, 'error');
                    }
                } else {
                    log(`‚ùå window.AudioAnalyzer n√£o √© fun√ß√£o: ${typeof window.AudioAnalyzer}`, 'error');
                }
            };
            
            script.onerror = () => {
                log('‚ùå Erro ao carregar script', 'error');
            };
            
            document.head.appendChild(script);
        }
        
        // Executar diagn√≥stico automaticamente
        diagnosticar();
    </script>
</body>
</html>
