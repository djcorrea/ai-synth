<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Botão + do Chat</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #0a0a1a;
            color: white;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #333;
            border-radius: 10px;
        }
        
        .test-input-field {
            position: relative;
            display: flex;
            align-items: center;
            gap: 12px;
            background: linear-gradient(135deg, 
                rgba(0, 150, 255, 0.1), 
                rgba(138, 43, 226, 0.1)
            );
            border: 2px solid rgba(0, 150, 255, 0.3);
            border-radius: 50px;
            padding: 0.6px 12px 0.6px 0.6px;
            margin: 20px 0;
        }
        
        .test-add-btn {
            order: -2;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            margin: 0 8px 0 10px;
            cursor: pointer;
            border-radius: 6px;
            background: transparent;
            border: none;
            color: white;
        }
        
        .test-input {
            order: 0;
            flex: 1;
            padding: 14px 24px;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.05rem;
            outline: none;
        }
        
        .test-mic-icon {
            order: 1;
            margin: 0 8px;
            font-size: 1.3rem;
            color: rgba(0, 150, 255, 0.7);
            cursor: pointer;
        }
        
        .test-send-btn {
            order: 2;
            border: none;
            background: #2563eb;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            width: 38px;
            height: 38px;
        }
        
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            background: #1a1a2e;
            font-family: monospace;
            font-size: 14px;
        }
        
        .success { border-left: 4px solid #00ff00; }
        .error { border-left: 4px solid #ff0000; }
        .info { border-left: 4px solid #0099ff; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🧪 Teste do Botão + do Chat</h1>
        
        <div class="test-section">
            <h2>Estado de Boas-vindas</h2>
            <div class="test-input-field chat-input-container">
                <button class="test-add-btn chat-plus-btn" aria-label="Adicionar">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                        <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2"/>
                    </svg>
                </button>
                <input type="text" class="test-input" placeholder="Digite sua mensagem...">
                <svg class="test-mic-icon" width="20" height="20" viewBox="0 0 384 512" fill="currentColor">
                    <path d="M192 0C139 0 96 43 96 96v160c0 53 43 96 96 96s96-43 96-96V96c0-53-43-96-96-96z"/>
                </svg>
                <button class="test-send-btn">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
                        <path d="M2 21L23 12L2 3V10L17 12L2 14V21Z" fill="white"/>
                    </svg>
                </button>
            </div>
            <div class="status info" id="status1">Aguardando teste...</div>
        </div>
        
        <div class="test-section">
            <h2>Estado Ativo</h2>
            <div class="test-input-field chat-input-container">
                <button class="test-add-btn chat-plus-btn" aria-label="Adicionar">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                        <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2"/>
                    </svg>
                </button>
                <input type="text" class="test-input" placeholder="Digite sua mensagem...">
                <svg class="test-mic-icon" width="20" height="20" viewBox="0 0 384 512" fill="currentColor">
                    <path d="M192 0C139 0 96 43 96 96v160c0 53 43 96 96 96s96-43 96-96V96c0-53-43-96-96-96z"/>
                </svg>
                <button class="test-send-btn">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
                        <path d="M2 21L23 12L2 3V10L17 12L2 14V21Z" fill="white"/>
                    </svg>
                </button>
            </div>
            <div class="status info" id="status2">Aguardando teste...</div>
        </div>
        
        <div class="test-section">
            <h2>Mobile Test (< 768px)</h2>
            <p>Redimensione a janela para testar o comportamento mobile.</p>
            <div class="status info" id="statusMobile">Use as ferramentas de desenvolvedor para simular mobile</div>
        </div>
    </div>

    <script>
        // Simular o script de setup do popover como no index.html
        function setupPopoverForContainer(container, plusBtn, statusEl) {
            if (!container || !plusBtn) return false;

            container.style.position = 'relative';
            container.querySelector('.chatplus-popover')?.remove();

            const pop = document.createElement('div');
            pop.className = 'chatplus-popover';
            pop.setAttribute('role', 'menu');
            pop.setAttribute('aria-hidden', 'true');
            Object.assign(pop.style, {
                position: 'absolute',
                left: '8px',
                bottom: 'calc(100% + 10px)',
                minWidth: '220px',
                background: '#0e0f1a',
                color: '#e9e9f1',
                border: '1px solid rgba(255,255,255,.08)',
                borderRadius: '12px',
                boxShadow: '0 10px 30px rgba(0,0,0,.35)',
                padding: '6px',
                opacity: '0',
                transform: 'scale(.98) translateY(4px)',
                pointerEvents: 'none',
                transition: 'opacity .15s ease, transform .15s ease',
                zIndex: '9999'
            });

            const mkItem = (label, action, svg) => {
                const b = document.createElement('button');
                b.className = 'chatplus-item';
                b.setAttribute('role', 'menuitem');
                b.dataset.action = action;
                Object.assign(b.style, {
                    width: '100%',
                    textAlign: 'left',
                    padding: '10px 12px',
                    border: '0',
                    background: 'transparent',
                    color: 'inherit',
                    borderRadius: '8px',
                    fontSize: '14px',
                    display: 'flex',
                    gap: '10px',
                    alignItems: 'center',
                    cursor: 'pointer'
                });
                b.onpointerenter = () => (b.style.background = 'rgba(255,255,255,.06)');
                b.onpointerleave = () => (b.style.background = 'transparent');
                b.innerHTML = `${svg}<span>${label}</span>`;
                return b;
            };

            const clipSVG = `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" style="display:block;stroke:#cfcff9;stroke-width:1.8"><path d="M8 12l6-6a4 4 0 1 1 6 6l-8 8a5 5 0 1 1-7-7l8-8"/></svg>`;
            const audioSVG = `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" style="display:block;stroke:#cfcff9;stroke-width:1.8"><path d="M3 12h2m2 0h2m2-6v12m4-9v6m4-3h2"/></svg>`;

            const addPhotos = mkItem('Adicionar fotos', 'upload', clipSVG);
            const analyzeSong = mkItem('Analisar música', 'analyze', audioSVG);
            pop.append(addPhotos, analyzeSong);
            container.appendChild(pop);

            function open() {
                document.querySelectorAll('.chatplus-popover').forEach(otherPop => {
                    if (otherPop !== pop && otherPop.getAttribute('aria-hidden') === 'false') {
                        otherPop.setAttribute('aria-hidden', 'true');
                        otherPop.style.opacity = '0';
                        otherPop.style.transform = 'scale(.98) translateY(4px)';
                        otherPop.style.pointerEvents = 'none';
                    }
                });

                pop.setAttribute('aria-hidden', 'false');
                pop.style.opacity = '1';
                pop.style.transform = 'scale(1) translateY(0)';
                pop.style.pointerEvents = 'auto';
                plusBtn.setAttribute('aria-expanded', 'true');
                statusEl.textContent = '✅ Popover aberto com sucesso!';
                statusEl.className = 'status success';
            }
            
            function close() {
                pop.setAttribute('aria-hidden', 'true');
                pop.style.opacity = '0';
                pop.style.transform = 'scale(.98) translateY(4px)';
                pop.style.pointerEvents = 'none';
                plusBtn.setAttribute('aria-expanded', 'false');
                statusEl.textContent = '✅ Popover fechado';
                statusEl.className = 'status info';
            }
            
            function toggle() {
                (pop.getAttribute('aria-hidden') === 'true') ? open() : close();
            }

            plusBtn.setAttribute('aria-haspopup', 'menu');
            plusBtn.setAttribute('aria-expanded', 'false');
            plusBtn.addEventListener('click', toggle);

            pop.addEventListener('click', (e) => {
                const btn = e.target.closest('.chatplus-item');
                if (!btn) return;
                statusEl.textContent = `✅ Clicou em: ${btn.dataset.action}`;
                statusEl.className = 'status success';
                close();
            });

            return true;
        }

        // Inicializar testes
        document.addEventListener('DOMContentLoaded', function() {
            const containers = document.querySelectorAll('.test-input-field.chat-input-container');
            const statusElements = [document.getElementById('status1'), document.getElementById('status2')];
            
            containers.forEach((container, index) => {
                const plusBtn = container.querySelector('.test-add-btn.chat-plus-btn');
                const statusEl = statusElements[index];
                
                if (setupPopoverForContainer(container, plusBtn, statusEl)) {
                    statusEl.textContent = `✅ Popover ${index + 1} configurado com sucesso`;
                    statusEl.className = 'status success';
                } else {
                    statusEl.textContent = `❌ Erro ao configurar popover ${index + 1}`;
                    statusEl.className = 'status error';
                }
            });
        });

        // Monitor de redimensionamento para teste mobile
        window.addEventListener('resize', function() {
            const statusMobile = document.getElementById('statusMobile');
            if (window.innerWidth < 768) {
                statusMobile.textContent = '📱 Modo Mobile Ativo - Teste os botões + agora';
                statusMobile.className = 'status success';
            } else {
                statusMobile.textContent = '💻 Modo Desktop - Redimensione para < 768px para teste mobile';
                statusMobile.className = 'status info';
            }
        });
    </script>
</body>
</html>
