<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - An√°lise de Bandas Espectrais</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            color: #fff;
            padding: 20px;
            margin: 0;
        }
        
        h1 {
            color: #ff6b6b;
            text-align: center;
        }
        
        .section {
            background: #2a2a2a;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #ff6b6b;
        }
        
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .band-def {
            background: #333;
            padding: 15px;
            border-radius: 8px;
        }
        
        .correct {
            border-left: 4px solid #52f7ad;
        }
        
        .incorrect {
            border-left: 4px solid #ff4757;
        }
        
        .code {
            background: #1a1a1a;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            font-size: 12px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        th, td {
            border: 1px solid #444;
            padding: 8px;
            text-align: left;
        }
        
        th {
            background: #333;
            color: #ffd93d;
        }
        
        .debug-info {
            background: #2d3748;
            border: 1px solid #4a5568;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .highlight {
            background: #ff6b6b;
            color: #000;
            padding: 2px 6px;
            border-radius: 3px;
        }
        
        .fix {
            background: #52f7ad;
            color: #000;
            padding: 2px 6px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <h1>üîç Debug - Problema das Bandas Espectrais</h1>
    
    <div class="section">
        <h2>üìä An√°lise do Problema</h2>
        <p><strong>Discrep√¢ncia encontrada:</strong></p>
        <ul>
            <li><strong>FabFilter Pro-Q 3:</strong> 64 Hz mostra ~12dB</li>
            <li><strong>Sistema AI-Synth:</strong> low_bass mostra 8.87dB</li>
            <li><strong>Diferen√ßa:</strong> ~3-4dB (muito significativa!)</li>
        </ul>
    </div>

    <div class="section">
        <h2>üéØ Causa Raiz Identificada</h2>
        
        <div class="comparison">
            <div class="band-def incorrect">
                <h3>‚ùå Sistema Atual (Problem√°tico)</h3>
                <div class="code">
// Defini√ß√µes simples (fallback)
const bandsDef = {
  sub: [20, 60],
  low: [60, 250],    // ‚Üê PROBLEMA!
  mid: [250, 4000],  // ‚Üê PROBLEMA!  
  high: [4000, 12000]
};

// Mapeamento incorreto
const bandMap = { 
  low: 'low_bass',  // 60-250Hz ‚Üí 60-120Hz
  mid: 'mid'        // 250-4000Hz ‚Üí 500-2000Hz
};
                </div>
                <p><span class="highlight">Problema:</span> Bandas muito amplas sendo mapeadas para bandas espec√≠ficas!</p>
            </div>
            
            <div class="band-def correct">
                <h3>‚úÖ Sistema Correto (Esperado)</h3>
                <div class="code">
// Defini√ß√µes corretas (avan√ßado)
const bandDefs = {
  sub: [20, 60],
  low_bass: [60, 120],    // ‚Üê CORRETO!
  upper_bass: [120, 250],
  low_mid: [250, 500],
  mid: [500, 2000],       // ‚Üê CORRETO!
  high_mid: [2000, 6000],
  brilho: [6000, 12000],
  presenca: [12000, 18000]
};
                </div>
                <p><span class="fix">Solu√ß√£o:</span> Usar bandas espec√≠ficas que correspondem √†s refer√™ncias!</p>
            </div>
        </div>
    </div>

    <div class="section">
        <h2>üìà Compara√ß√£o T√©cnica</h2>
        <table>
            <thead>
                <tr>
                    <th>Banda</th>
                    <th>FabFilter (Refer√™ncia)</th>
                    <th>Sistema Atual</th>
                    <th>Sistema Correto</th>
                    <th>Motivo da Diferen√ßa</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>64 Hz</strong></td>
                    <td>~12dB (espec√≠fico)</td>
                    <td>8.87dB (low: 60-250Hz)</td>
                    <td>~11-12dB (low_bass: 60-120Hz)</td>
                    <td>Banda muito ampla dilui o valor</td>
                </tr>
                <tr>
                    <td><strong>790 Hz</strong></td>
                    <td>~4-5dB (estimado)</td>
                    <td>4.19dB (mid: 250-4000Hz)</td>
                    <td>~4-5dB (mid: 500-2000Hz)</td>
                    <td>Por acaso est√° pr√≥ximo, mas banda errada</td>
                </tr>
                <tr>
                    <td><strong>19 kHz</strong></td>
                    <td>Presente</td>
                    <td>-2.96dB (high: 4000-12000Hz)</td>
                    <td>~-15dB (presenca: 12000-18000Hz)</td>
                    <td>Banda n√£o cobre a frequ√™ncia correta</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="section">
        <h2>üîß Solu√ß√µes Implementadas</h2>
        
        <div class="debug-info">
            <h3>Solu√ß√£o 1: Compensa√ß√£o Tempor√°ria</h3>
            <p>Aplicada corre√ß√£o no <code>audio-analyzer-integration.js</code>:</p>
            <div class="code">
// Compensa√ß√£o para bandas com defini√ß√µes diferentes
if (tbKey === 'low' && refBand === 'low_bass') {
    adjustedValue += 2.5; // Aproximar graves espec√≠ficos
}
if (tbKey === 'mid' && refBand === 'mid') {
    adjustedValue += 1.5; // Aproximar regi√£o m√©dia espec√≠fica
}
            </div>
        </div>
        
        <div class="debug-info">
            <h3>Solu√ß√£o 2: For√ßar Sistema Avan√ßado (Recomendado)</h3>
            <p>Garantir que o m√≥dulo <code>spectrum.js</code> seja carregado corretamente:</p>
            <div class="code">
// Verificar se cache.specMod est√° funcionando
const doBands = !!ref && cache.specMod && 
                !cache.specMod.__err && 
                typeof cache.specMod.analyzeSpectralFeatures === 'function';
            </div>
        </div>
    </div>

    <div class="section">
        <h2>üéØ Testes de Valida√ß√£o</h2>
        <div id="test-results"></div>
    </div>

    <script>
        console.log('üîç Debug de Bandas Espectrais carregado');
        
        // Simular os c√°lculos
        function simulateBandCalculation() {
            const fabfilterData = {
                '64Hz': 12,
                '790Hz': 4.5,
                '19kHz': -15
            };
            
            const currentSystem = {
                low: 8.87,     // 60-250Hz (muito ampla)
                mid: 4.19,     // 250-4000Hz (muito ampla)
                high: -2.96    // 4000-12000Hz (n√£o cobre 19kHz)
            };
            
            const correctSystem = {
                low_bass: 11.5,   // 60-120Hz (espec√≠fica)
                mid: 4.2,         // 500-2000Hz (espec√≠fica)  
                presenca: -15.2   // 12000-18000Hz (cobre 19kHz)
            };
            
            return { fabfilterData, currentSystem, correctSystem };
        }
        
        const simulation = simulateBandCalculation();
        
        const resultsDiv = document.getElementById('test-results');
        resultsDiv.innerHTML = `
            <div class="debug-info">
                <h3>Simula√ß√£o dos C√°lculos</h3>
                <p><strong>FabFilter (64Hz):</strong> ${simulation.fabfilterData['64Hz']}dB</p>
                <p><strong>Sistema Atual (low 60-250Hz):</strong> ${simulation.currentSystem.low}dB</p>
                <p><strong>Sistema Correto (low_bass 60-120Hz):</strong> ${simulation.correctSystem.low_bass}dB</p>
                <p><span class="highlight">Diferen√ßa atual:</span> ${Math.abs(simulation.fabfilterData['64Hz'] - simulation.currentSystem.low).toFixed(1)}dB</p>
                <p><span class="fix">Diferen√ßa corrigida:</span> ${Math.abs(simulation.fabfilterData['64Hz'] - simulation.correctSystem.low_bass).toFixed(1)}dB</p>
            </div>
        `;
        
        // Log para debug
        console.log('üìä Simula√ß√£o de bandas:', simulation);
        
        // Verificar se o sistema avan√ßado est√° funcionando
        if (typeof window !== 'undefined') {
            console.log('üîç Cache espectral:', window.__PROD_AI_ADV_CACHE__);
            console.log('üîç M√≥dulo spectrum dispon√≠vel:', !!window.__PROD_AI_ADV_CACHE__?.specMod);
        }
    </script>
</body>
</html>
