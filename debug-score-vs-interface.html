<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔍 Debug Score vs Interface</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a1a2e; color: #fff; }
        .explanation { background: #16213e; padding: 20px; margin: 20px 0; border-radius: 8px; border-left: 4px solid #4CAF50; }
        .problem { background: rgba(244, 67, 54, 0.1); padding: 20px; margin: 20px 0; border-radius: 8px; border-left: 4px solid #f44336; }
        .solution { background: rgba(76, 175, 80, 0.1); padding: 20px; margin: 20px 0; border-radius: 8px; border-left: 4px solid #4CAF50; }
        pre { background: #0d1421; padding: 15px; border-radius: 4px; overflow-x: auto; }
        .test-box { background: #16213e; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .score-example { display: flex; justify-content: space-between; padding: 10px; margin: 5px 0; border-radius: 4px; }
        .green-score { background: rgba(76, 175, 80, 0.2); }
        .yellow-score { background: rgba(255, 193, 7, 0.2); }
        .red-score { background: rgba(244, 67, 54, 0.2); }
    </style>
</head>
<body>
    <h1>🔍 Debug: Score vs Interface Colors</h1>
    
    <div class="explanation">
        <h2>🎯 Análise do Problema</h2>
        <p><strong>Situação reportada:</strong> "3 verde, 1 amarelo, 8 vermelho mas score é 50"</p>
        <p><strong>Hipótese:</strong> Você está olhando as cores dos <em>diagnósticos/bandas</em> e não dos <em>sub-scores de qualidade</em>.</p>
    </div>

    <div class="problem">
        <h3>🚨 Duas Escalas Diferentes!</h3>
        <p>O sistema tem <strong>duas</strong> escalas de cor completamente diferentes:</p>
        
        <h4>1. Sub-Scores de Qualidade (5 categorias):</h4>
        <div class="test-box">
            <div class="score-example green-score">
                <span>Dynamics: 85/100</span> <span>🟢 Verde (≥80)</span>
            </div>
            <div class="score-example yellow-score">
                <span>Technical: 65/100</span> <span>🟡 Amarelo (60-79)</span>
            </div>
            <div class="score-example red-score">
                <span>Loudness: 13/100</span> <span>🔴 Vermelho (&lt;60)</span>
            </div>
            <p><strong>Score Final:</strong> Média ponderada dos 5 valores numéricos</p>
        </div>

        <h4>2. Diagnósticos/Bandas (até 12+ itens):</h4>
        <div class="test-box">
            <div class="score-example green-score">
                <span>Sub: -17.3 dB</span> <span>🟢 Verde (dentro tolerância)</span>
            </div>
            <div class="score-example yellow-score">
                <span>Low Bass: -12.1 dB</span> <span>🟡 Amarelo (1-2x tolerância)</span>
            </div>
            <div class="score-example red-score">
                <span>Mid: -8.2 dB</span> <span>🔴 Vermelho (&gt;2x tolerância)</span>
            </div>
            <p><strong>Cores baseadas em:</strong> Tolerância do gênero musical</p>
        </div>
    </div>

    <div class="solution">
        <h3>✅ Explicação da Inconsistência</h3>
        
        <h4>Cenário Provável:</h4>
        <pre>Sub-Scores de Qualidade (influenciam score final):
├── Dynamics: 75/100    (🟡 amarelo)
├── Technical: 85/100   (🟢 verde)  
├── Stereo: 90/100      (🟢 verde)
├── Loudness: 13/100    (🔴 vermelho)
└── Frequency: 40/100   (🔴 vermelho)

Score Final: (75*0.25 + 85*0.15 + 90*0.20 + 13*0.20 + 40*0.20) ≈ 50/100

Diagnósticos de Bandas (não influenciam score):
├── 🟢 Sub: -17.3 dB (ok)
├── 🟢 Low Bass: -14.6 dB (ok)  
├── 🟢 Upper Bass: -14.8 dB (ok)
├── 🟡 Low Mid: -10.4 dB (amarelo)
├── 🔴 Mid: -8.2 dB (vermelho)
├── 🔴 High Mid: -18.1 dB (vermelho)
├── 🔴 Brilho: -22.3 dB (vermelho)
├── 🔴 Presença: -29.8 dB (vermelho)
├── 🔴 Clipping: 0.3% (vermelho)
├── 🔴 DR: 5.2 dB (vermelho)
├── 🔴 LUFS: -0.5 (vermelho)
└── 🔴 True Peak: +1.2 dB (vermelho)</pre>

        <p><strong>Total:</strong> 3 verde + 1 amarelo + 8 vermelho = 12 diagnósticos</p>
        <p><strong>Mas:</strong> Score final = 50 (baseado nos 5 sub-scores, não nos 12 diagnósticos)</p>
    </div>

    <div class="test-box">
        <h3>🧮 Teste do Cálculo</h3>
        <button onclick="testCalculation()" id="testBtn">Testar Cálculo Manual</button>
        <div id="result"></div>
    </div>

    <script>
        function testCalculation() {
            // Valores de exemplo que dariam score ~50 mas com a distribuição que você viu
            const subScores = {
                dynamics: 75,    // Média
                technical: 85,   // Boa
                stereo: 90,      // Boa  
                loudness: 13,    // Ruim (LUFS -0.5)
                frequency: 40    // Ruim
            };
            
            const weights = {
                dynamics: 0.25,
                frequency: 0.20,
                stereo: 0.20,
                loudness: 0.20,
                technical: 0.15
            };
            
            const score = Math.round(
                subScores.dynamics * weights.dynamics +
                subScores.frequency * weights.frequency +
                subScores.stereo * weights.stereo +
                subScores.loudness * weights.loudness +
                subScores.technical * weights.technical
            );
            
            // Contar cores dos sub-scores
            const scores = Object.values(subScores);
            const green = scores.filter(s => s >= 80).length;
            const yellow = scores.filter(s => s >= 60 && s < 80).length;
            const red = scores.filter(s => s < 60).length;
            
            document.getElementById('result').innerHTML = `
                <h4>Resultado do Teste:</h4>
                <pre>Sub-Scores:
Dynamics: ${subScores.dynamics}/100 (${subScores.dynamics >= 80 ? '🟢' : subScores.dynamics >= 60 ? '🟡' : '🔴'})
Technical: ${subScores.technical}/100 (${subScores.technical >= 80 ? '🟢' : subScores.technical >= 60 ? '🟡' : '🔴'})
Stereo: ${subScores.stereo}/100 (${subScores.stereo >= 80 ? '🟢' : subScores.stereo >= 60 ? '🟡' : '🔴'})
Loudness: ${subScores.loudness}/100 (${subScores.loudness >= 80 ? '🟢' : subScores.loudness >= 60 ? '🟡' : '🔴'})
Frequency: ${subScores.frequency}/100 (${subScores.frequency >= 80 ? '🟢' : subScores.frequency >= 60 ? '🟡' : '🔴'})

Sub-Scores Colors: ${green} verde, ${yellow} amarelo, ${red} vermelho
Score Final: ${score}/100

✅ Se você viu "3 verde, 1 amarelo, 8 vermelho" mas score é 50,
   você estava olhando os DIAGNÓSTICOS (12 itens) 
   e não os SUB-SCORES (5 itens)!</pre>
            `;
        }
    </script>
</body>
</html>
