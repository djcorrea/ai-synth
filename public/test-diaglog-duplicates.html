<!DOCTYPE html>
<html>
<head>
    <title>Teste Elimina√ß√£o Duplicatas diagLog</title>
</head>
<body>
    <h1>Teste Elimina√ß√£o de Duplicatas diagLog</h1>
    <p>Verificando se n√£o h√° mais erros "Identifier 'diagLog' has already been declared"</p>
    
    <div id="status"></div>
    <button onclick="runTests()">Executar Testes</button>
    <button onclick="clearConsole()">Limpar Console</button>
    
    <h2>Scripts Carregados</h2>
    <div id="scripts-status"></div>
    
    <script src="diag-log-throttle.js?v=test"></script>
    <script src="audio-analyzer.js?v=test"></script>
    <script>
        function updateStatus() {
            const status = document.getElementById('status');
            const scriptsStatus = document.getElementById('scripts-status');
            
            // Verificar se diagLog est√° dispon√≠vel
            const diagLogAvailable = typeof window.diagLog === 'function';
            const analyzerDiagAvailable = window.AnalyzerDiag && window.AnalyzerDiag.logger;
            const protectedVarsExist = window.__ANALYZER_DIAG_LOG__ && window.__SCORING_DIAG_LOG__ && window.__V2_DIAG_LOG__;
            
            status.innerHTML = `
                <h3>Status dos Sistemas</h3>
                <p>‚úÖ diagLog global: ${diagLogAvailable ? '‚úÖ OK' : '‚ùå ERRO'}</p>
                <p>‚úÖ AnalyzerDiag namespace: ${analyzerDiagAvailable ? '‚úÖ OK' : '‚ùå ERRO'}</p>
                <p>‚úÖ Vari√°veis protegidas: ${protectedVarsExist ? '‚úÖ OK' : '‚ùå ERRO'}</p>
                <p>‚úÖ AudioAnalyzer dispon√≠vel: ${typeof window.AudioAnalyzer !== 'undefined' ? '‚úÖ OK' : '‚ùå ERRO'}</p>
            `;
            
            // Lista de scripts carregados
            const scripts = Array.from(document.querySelectorAll('script[src]')).map(s => s.src);
            scriptsStatus.innerHTML = `
                <ul>
                    ${scripts.map(src => `<li>${src.split('/').pop()}</li>`).join('')}
                </ul>
                <p>Total: ${scripts.length} scripts</p>
            `;
        }
        
        function runTests() {
            console.log('üß™ === TESTE ELIMINA√á√ÉO DUPLICATAS DIAGLOG ===');
            
            try {
                // Teste 1: Verificar se diagLog funciona
                console.log('üß™ Teste 1: Chamada b√°sica diagLog');
                diagLog('TEST', 'Teste b√°sico de funcionamento', { test: true });
                console.log('‚úÖ diagLog funcionando');
                
                // Teste 2: Verificar namespace
                console.log('üß™ Teste 2: Namespace AnalyzerDiag');
                if (window.AnalyzerDiag && window.AnalyzerDiag.logger) {
                    window.AnalyzerDiag.logger.log('TEST', 'Teste via namespace', { direct: true });
                    console.log('‚úÖ Namespace funcionando');
                } else {
                    console.log('‚ùå Namespace n√£o dispon√≠vel');
                }
                
                // Teste 3: M√∫ltiplas chamadas (throttling)
                console.log('üß™ Teste 3: Throttling (10 chamadas r√°pidas)');
                for (let i = 0; i < 10; i++) {
                    diagLog('THROTTLE_TEST', `Mensagem ${i}`, { iteration: i });
                }
                console.log('‚úÖ Throttling testado');
                
                // Teste 4: Verificar se n√£o h√° conflitos
                console.log('üß™ Teste 4: Verifica√ß√£o de conflitos');
                const errors = [];
                
                try { eval('const diagLog = function(){}'); } 
                catch(e) { console.log('‚úÖ Prote√ß√£o contra redeclara√ß√£o funcionando:', e.message); }
                
                console.log('üéâ TODOS OS TESTES CONCLU√çDOS');
                
            } catch (error) {
                console.error('‚ùå ERRO NOS TESTES:', error);
            }
        }
        
        function clearConsole() {
            console.clear();
            console.log('üßπ Console limpo - execute os testes novamente');
        }
        
        // Verificar status a cada 2 segundos
        setInterval(updateStatus, 2000);
        updateStatus();
        
        // Executar teste b√°sico automaticamente
        setTimeout(() => {
            console.log('üî¨ Teste autom√°tico iniciado');
            runTests();
        }, 1000);
    </script>
</body>
</html>
