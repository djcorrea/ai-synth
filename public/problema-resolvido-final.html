<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>🔥 PROBLEMA RESOLVIDO DEFINITIVAMENTE</title>
    <style>
        body { font-family: monospace; background: #000; color: #0f0; padding: 20px; }
        .result { background: #111; padding: 15px; margin: 10px 0; border: 1px solid #333; }
        .success { color: #4f4; font-weight: bold; }
        .error { color: #f44; font-weight: bold; }
        .info { color: #44f; font-weight: bold; }
        .build-display { font-size: 1.5em; background: #002200; padding: 15px; border: 3px solid #0f0; }
        button { background: #333; color: #0f0; border: 1px solid #0f0; padding: 10px; margin: 5px; cursor: pointer; }
        button:hover { background: #0f0; color: #000; }
    </style>
</head>
<body>
    <h1>🔥 PROBLEMA RESOLVIDO DEFINITIVAMENTE</h1>
    
    <div class="result">
        <h3>🎯 BUILD VERSION STATUS</h3>
        <div id="build-display" class="build-display">Verificando...</div>
    </div>
    
    <div class="result">
        <h3>🧪 Testes</h3>
        <button onclick="testarBuildVersion()">🎯 TESTAR BUILD VERSION</button>
        <button onclick="testarAnaliseCompleta()">🚀 ANÁLISE COMPLETA</button>
    </div>
    
    <div class="result">
        <h3>📊 Resultados</h3>
        <div id="resultados">Aguardando...</div>
    </div>

    <!-- CARREGANDO O ARQUIVO PRINCIPAL CORRIGIDO -->
    <script src="audio-analyzer.js"></script>
    
    <script>
        function testarBuildVersion() {
            console.log('🔥 Testando BUILD VERSION...');
            
            // Aguardar carregamento
            setTimeout(() => {
                if (window.AudioAnalyzerV2) {
                    const v2 = new window.AudioAnalyzerV2();
                    const buildVersion = v2.__buildVersion;
                    
                    document.getElementById('build-display').innerHTML = `
                        <div class="${buildVersion && buildVersion !== 'undefined' ? 'success' : 'error'}">
                            🎯 BUILD VERSION: <strong>${buildVersion}</strong>
                        </div>
                        <div class="info">Tipo: ${typeof buildVersion}</div>
                        <div class="info">É undefined? ${buildVersion === undefined}</div>
                        <div class="info">É string 'undefined'? ${buildVersion === 'undefined'}</div>
                    `;
                    
                    if (buildVersion && buildVersion !== 'undefined') {
                        console.log('🎉 BUILD VERSION FUNCIONANDO:', buildVersion);
                        document.getElementById('resultados').innerHTML = `
                            <div class="success">✅ PROBLEMA RESOLVIDO!</div>
                            <div class="success">🎯 Build Version: ${buildVersion}</div>
                            <div class="success">🎉 Sistema funcionando perfeitamente!</div>
                        `;
                    } else {
                        console.error('❌ BUILD VERSION ainda com problema:', buildVersion);
                    }
                } else {
                    console.error('❌ AudioAnalyzerV2 não encontrado');
                    document.getElementById('build-display').innerHTML = `
                        <div class="error">❌ AudioAnalyzerV2 não encontrado</div>
                    `;
                }
            }, 500);
        }
        
        function testarAnaliseCompleta() {
            console.log('🚀 Testando análise completa...');
            
            // Gerar áudio teste
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const audioBuffer = audioContext.createBuffer(2, audioContext.sampleRate * 2, audioContext.sampleRate);
            
            const left = audioBuffer.getChannelData(0);
            const right = audioBuffer.getChannelData(1);
            
            for (let i = 0; i < audioBuffer.length; i++) {
                const t = i / audioContext.sampleRate;
                const sample = 0.3 * Math.sin(2 * Math.PI * 440 * t);
                left[i] = sample;
                right[i] = sample * 0.9;
            }
            
            // Testar análise
            if (window.AudioAnalyzerV2) {
                const v2 = new window.AudioAnalyzerV2();
                
                v2.performFullAnalysis(audioBuffer).then(result => {
                    console.log('✅ ANÁLISE COMPLETA OK:', result);
                    
                    document.getElementById('resultados').innerHTML = `
                        <div class="success">🎉 SISTEMA FUNCIONANDO COMPLETAMENTE!</div>
                        <div class="success">🎯 Build Version: ${result.buildVersion}</div>
                        <div class="success">🔥 __refEvidence: ${result.__refEvidence}</div>
                        <div class="info">📊 Peak: ${result.technicalData.peak.toFixed(1)} dB</div>
                        <div class="info">🎵 Duração: ${result.duration.toFixed(2)}s</div>
                        <div class="info">💡 Problemas: ${result.diagnostics.problems.length}</div>
                        <div class="info">🎯 Sugestões: ${result.diagnostics.suggestions.length}</div>
                        <div class="info">📚 Referência: ${result.diagnostics.referenceGenre}</div>
                    `;
                }).catch(error => {
                    console.error('❌ Erro na análise:', error);
                });
            }
        }
        
        // Auto-teste na inicialização
        window.addEventListener('load', () => {
            console.log('🚀 Página carregada');
            
            setTimeout(() => {
                testarBuildVersion();
                
                setTimeout(() => {
                    testarAnaliseCompleta();
                }, 1000);
            }, 1000);
        });
    </script>
</body>
</html>
