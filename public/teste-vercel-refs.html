<!DOCTYPE html>
<html>
<head>
    <title>TESTE VERCEL - Carregamento de Referências</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
        .log { background: #f8f9fa; padding: 5px; margin: 5px 0; }
    </style>
</head>
<body>
    <h1>🔍 TESTE VERCEL - Carregamento de Referências</h1>
    <button onclick="testarTodos()">🚀 TESTAR TODOS OS PATHS</button>
    <div id="results"></div>

    <script>
        async function testarPath(path, nome) {
            const div = document.createElement('div');
            div.className = 'test';
            div.innerHTML = `<strong>${nome}</strong>: ${path}`;
            
            try {
                console.log(`🔍 Testando: ${path}`);
                const response = await fetch(path, {
                    cache: 'no-store',
                    headers: {
                        'Cache-Control': 'no-cache',
                        'Pragma': 'no-cache'
                    }
                });
                
                const log = document.createElement('div');
                log.className = 'log';
                log.innerHTML = `Status: ${response.status} | Headers: ${JSON.stringify([...response.headers.entries()])}`;
                div.appendChild(log);
                
                if (response.ok) {
                    const data = await response.json();
                    div.className += ' success';
                    div.innerHTML += `<br>✅ SUCESSO - Tamanho: ${JSON.stringify(data).length} chars`;
                    console.log(`✅ ${nome} - OK:`, data);
                } else {
                    div.className += ' error';
                    div.innerHTML += `<br>❌ ERRO ${response.status} - ${response.statusText}`;
                    console.log(`❌ ${nome} - ERRO:`, response.status, response.statusText);
                }
            } catch (error) {
                div.className += ' error';
                div.innerHTML += `<br>💥 EXCEÇÃO: ${error.message}`;
                console.log(`💥 ${nome} - EXCEÇÃO:`, error);
            }
            
            return div;
        }

        async function testarTodos() {
            const results = document.getElementById('results');
            results.innerHTML = '<h2>🔄 Testando...</h2>';
            
            const testes = [
                // Paths que o código está tentando usar
                ['/refs/out/funk_mandela.json', 'Funk Mandela (path principal)'],
                ['/refs/out/trance.json', 'Trance (path principal)'],
                ['/refs/out/eletronico.json', 'Eletrônico (path principal)'],
                ['/refs/out/genres.json', 'Genres (path principal)'],
                
                // Com cache busting
                [`/refs/out/funk_mandela.json?v=${Date.now()}`, 'Funk Mandela (com cache bust)'],
                [`/refs/out/trance.json?cb=${Date.now()}`, 'Trance (com cache bust)'],
                
                // Paths alternativos
                ['/public/refs/out/funk_mandela.json', 'Funk Mandela (path public)'],
                ['./refs/out/funk_mandela.json', 'Funk Mandela (path relativo)'],
                ['refs/out/funk_mandela.json', 'Funk Mandela (sem barra inicial)'],
            ];
            
            const resultados = [];
            for (const [path, nome] of testes) {
                const resultado = await testarPath(path, nome);
                resultados.push(resultado);
            }
            
            results.innerHTML = '<h2>📊 Resultados:</h2>';
            resultados.forEach(r => results.appendChild(r));
            
            // Log consolidado
            console.log('🏁 TESTE CONCLUÍDO - Verifique os resultados acima');
        }

        // Auto-executar ao carregar
        window.addEventListener('load', () => {
            console.log('🔍 PÁGINA DE TESTE CARREGADA');
            console.log('📍 URL atual:', window.location.href);
            console.log('🌐 Origin:', window.location.origin);
        });
    </script>
</body>
</html>
