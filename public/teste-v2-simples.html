<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Scoring V2 Simples</title>
    <style>
        body { 
            font-family: 'Courier New', monospace; 
            background: #000; 
            color: #00ff00; 
            padding: 20px; 
        }
        .button {
            background: #002200;
            color: #00ff00;
            border: 2px solid #00ff00;
            padding: 15px 30px;
            margin: 10px;
            border-radius: 5px;
            cursor: pointer;
            display: inline-block;
            font-size: 16px;
            font-weight: bold;
        }
        .button:hover { background: #004400; }
        .result {
            background: rgba(0,255,0,0.1);
            border: 1px solid #00ff00;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            white-space: pre-wrap;
        }
        .success { border-color: #00ff00; background: rgba(0,255,0,0.2); }
        .error { border-color: #ff0000; background: rgba(255,0,0,0.1); color: #ff6666; }
    </style>
</head>
<body>
    <h1>üß™ TESTE SCORING V2 SIMPLIFICADO</h1>
    
    <div class="button" onclick="testV1()">Testar V1</div>
    <div class="button" onclick="testV2()">Testar V2</div>
    <div class="button" onclick="compareV1vsV2()">Comparar V1 vs V2</div>
    <div class="button" onclick="enableV2()">Habilitar V2</div>
    <div class="button" onclick="disableV2()">Desabilitar V2</div>
    
    <div id="results"></div>

    <!-- Carregar sistema V2 -->
    <script src="scoring-v2-complete.js?v=20250823"></script>

    <script>
        function addResult(message, type = 'result') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            document.getElementById('results').appendChild(div);
            console.log(message);
        }

        // Dados de teste padr√£o
        const testData = {
            lufsIntegrated: -12.5,
            truePeakDbtp: -0.8,
            dynamicRange: 6.2,
            lra: 4.5,
            stereoCorrelation: 0.75,
            dcOffset: 0.0001,
            clippingPercent: 0,
            bandEnergies: {
                sub_bass: { rms_db: -8.2 },
                bass: { rms_db: -6.8 },
                low_mid: { rms_db: -7.5 },
                mid: { rms_db: -9.1 },
                high_mid: { rms_db: -12.3 },
                treble: { rms_db: -15.6 }
            }
        };
        
        const reference = { genre: 'funk_mandela' };

        async function testV1() {
            try {
                addResult('üß™ Testando Scoring V1...', 'result');
                
                window.SCORING_V2_TEST = false;
                
                if (!window.ScoringV2Complete) {
                    addResult('‚ùå Sistema V2 n√£o carregado', 'error');
                    return;
                }
                
                const result = await window.ScoringV2Complete.computeMixScore(testData, reference);
                
                addResult(`‚úÖ V1: ${result.scorePct}% (${result.method}) - ${result.classification}`, 'success');
                addResult(`   Tempo: ${result.processingTime}ms`, 'result');
                
            } catch (error) {
                addResult(`‚ùå Erro V1: ${error.message}`, 'error');
            }
        }

        async function testV2() {
            try {
                addResult('üß™ Testando Scoring V2...', 'result');
                
                window.SCORING_V2_TEST = true;
                
                if (!window.ScoringV2Complete) {
                    addResult('‚ùå Sistema V2 n√£o carregado', 'error');
                    return;
                }
                
                const result = await window.ScoringV2Complete.computeMixScore(testData, reference);
                
                addResult(`‚úÖ V2: ${result.scorePct}% (${result.method}) - ${result.classification}`, 'success');
                addResult(`   Vers√£o: ${result.scoringVersion}`, 'result');
                addResult(`   G√™nero: ${result.genre}`, 'result');
                addResult(`   Tempo: ${result.processingTime}ms`, 'result');
                
                if (result.method.includes('v2')) {
                    addResult('üéâ V2 est√° funcionando corretamente!', 'success');
                } else {
                    addResult('‚ö†Ô∏è V2 n√£o foi usado (fallback)', 'error');
                }
                
            } catch (error) {
                addResult(`‚ùå Erro V2: ${error.message}`, 'error');
            }
        }

        async function compareV1vsV2() {
            try {
                addResult('üîÑ Comparando V1 vs V2...', 'result');
                
                if (!window.ScoringV2Complete) {
                    addResult('‚ùå Sistema V2 n√£o carregado', 'error');
                    return;
                }
                
                // Teste V1
                window.SCORING_V2_TEST = false;
                const v1Result = await window.ScoringV2Complete.computeMixScore(testData, reference);
                
                // Teste V2
                window.SCORING_V2_TEST = true;
                const v2Result = await window.ScoringV2Complete.computeMixScore(testData, reference);
                
                const improvement = v2Result.scorePct - v1Result.scorePct;
                const improvementPct = v1Result.scorePct > 0 ? (improvement / v1Result.scorePct * 100) : 0;
                
                addResult('üéØ COMPARA√á√ÉO COMPLETA:', 'result');
                addResult(`   V1: ${v1Result.scorePct}% (${v1Result.method})`, 'result');
                addResult(`   V2: ${v2Result.scorePct}% (${v2Result.method})`, 'result');
                addResult(`   Melhoria: ${improvement > 0 ? '+' : ''}${improvement.toFixed(1)} pontos`, 'result');
                addResult(`   Melhoria %: ${improvementPct > 0 ? '+' : ''}${improvementPct.toFixed(1)}%`, 'result');
                
                if (v2Result.method.includes('v2')) {
                    if (improvement > 0) {
                        addResult('üéâ SUCESSO: V2 melhorou o score!', 'success');
                    } else {
                        addResult('‚úÖ V2 funcionando (score neutro)', 'success');
                    }
                } else {
                    addResult('‚ùå V2 n√£o est√° funcionando', 'error');
                }
                
            } catch (error) {
                addResult(`‚ùå Erro na compara√ß√£o: ${error.message}`, 'error');
            }
        }

        function enableV2() {
            if (window.enableScoringV2Test) {
                window.enableScoringV2Test();
                addResult('üß™ V2 habilitado!', 'success');
            } else {
                addResult('‚ùå Fun√ß√£o enableScoringV2Test n√£o encontrada', 'error');
            }
        }

        function disableV2() {
            if (window.disableScoringV2Test) {
                window.disableScoringV2Test();
                addResult('üõ°Ô∏è V2 desabilitado!', 'result');
            } else {
                addResult('‚ùå Fun√ß√£o disableScoringV2Test n√£o encontrada', 'error');
            }
        }

        // Verificar carregamento
        window.addEventListener('load', () => {
            setTimeout(() => {
                if (window.ScoringV2Complete) {
                    addResult('‚úÖ Sistema V2 carregado com sucesso!', 'success');
                    addResult('üí° Use os bot√µes acima para testar', 'result');
                } else {
                    addResult('‚ùå Sistema V2 n√£o foi carregado', 'error');
                }
            }, 500);
        });
    </script>
</body>
</html>
