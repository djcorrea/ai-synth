<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔍 Teste Final - Referências Vercel</title>
    <style>
        body { font-family: Arial, sans-serif; background: #0d1117; color: #e6edf3; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #1a472a; border: 1px solid #2ea043; }
        .error { background: #4c1e1e; border: 1px solid #f85149; }
        .warning { background: #4a3d1a; border: 1px solid #d29922; }
        .mono { font-family: 'Courier New', monospace; background: #21262d; padding: 2px 4px; border-radius: 3px; }
        .valor { color: #7ee787; font-weight: bold; }
        table { border-collapse: collapse; width: 100%; margin: 20px 0; }
        th, td { border: 1px solid #30363d; padding: 8px; text-align: left; }
        th { background: #21262d; }
        .diff { color: #f85149; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔍 Teste Final - Validação Vercel</h1>
        <p>Verificando se as referências corretas estão sendo carregadas em produção.</p>
        
        <div id="loadStatus" class="status warning">🔄 Carregando referências...</div>
        
        <div id="resultados" style="display: none;">
            <h2>📊 Resultados da Validação</h2>
            <table id="tabela-generos">
                <thead>
                    <tr>
                        <th>Gênero</th>
                        <th>LUFS Target</th>
                        <th>DR Target</th>
                        <th>Status</th>
                        <th>Versão</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            
            <h2>🎯 Valores Esperados vs Recebidos</h2>
            <div id="comparacao"></div>
        </div>
    </div>

    <script src="refs/embedded-refs.js?v=1756088323635&corrected=1724440700"></script>
    <script>
        // Valores esperados (corretos)
        const valoresEsperados = {
            'funk_mandela': { lufs: -4.9, dr: 6.8 },
            'eletrofunk': { lufs: -9.2, dr: 6.8 },
            'trap': { lufs: -7.8, dr: 7.2 },
            'phonk': { lufs: -6.5, dr: 7.8 },
            'hardtek': { lufs: -6.8, dr: 8.2 },
            'frenchcore': { lufs: -5.9, dr: 8.8 },
            'uptempo': { lufs: -6.2, dr: 9.1 },
            'terror': { lufs: -5.8, dr: 9.5 }
        };

        function validarReferencias() {
            const loadStatus = document.getElementById('loadStatus');
            const resultados = document.getElementById('resultados');
            
            if (!window.PROD_AI_REF_DATA) {
                loadStatus.className = 'status error';
                loadStatus.innerHTML = '❌ ERRO: window.PROD_AI_REF_DATA não encontrado!';
                return;
            }

            const refs = window.PROD_AI_REF_DATA;
            const tbody = document.querySelector('#tabela-generos tbody');
            const comparacao = document.getElementById('comparacao');
            
            let todosCorretos = true;
            let html = '';
            
            Object.entries(valoresEsperados).forEach(([genero, esperado]) => {
                const dados = refs[genero];
                if (!dados) {
                    html += `<tr><td>${genero}</td><td colspan="4" class="diff">❌ Gênero não encontrado</td></tr>`;
                    todosCorretos = false;
                    return;
                }
                
                const lufsRecebido = dados.legacy_compatibility.lufs_target;
                const drRecebido = dados.legacy_compatibility.dr_target;
                const versao = dados.version || 'N/A';
                
                const lufsCorreto = Math.abs(lufsRecebido - esperado.lufs) < 0.1;
                const drCorreto = Math.abs(drRecebido - esperado.dr) < 0.1;
                const statusCorreto = lufsCorreto && drCorreto;
                
                if (!statusCorreto) todosCorretos = false;
                
                const statusIcon = statusCorreto ? '✅' : '❌';
                const statusClass = statusCorreto ? 'valor' : 'diff';
                
                html += `
                    <tr>
                        <td>${genero}</td>
                        <td class="${lufsCorreto ? 'valor' : 'diff'}">${lufsRecebido}</td>
                        <td class="${drCorreto ? 'valor' : 'diff'}">${drRecebido}</td>
                        <td class="${statusClass}">${statusIcon} ${statusCorreto ? 'Correto' : 'Incorreto'}</td>
                        <td class="mono">${versao.substring(0, 20)}...</td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
            
            // Comparação detalhada
            let compHtml = '';
            Object.entries(valoresEsperados).forEach(([genero, esperado]) => {
                const dados = refs[genero];
                if (dados) {
                    const lufsRecebido = dados.legacy_compatibility.lufs_target;
                    const drRecebido = dados.legacy_compatibility.dr_target;
                    
                    compHtml += `
                        <div class="status ${Math.abs(lufsRecebido - esperado.lufs) < 0.1 ? 'success' : 'error'}">
                            <strong>${genero}:</strong><br>
                            LUFS: Esperado <span class="mono">${esperado.lufs}</span>, Recebido <span class="mono">${lufsRecebido}</span><br>
                            DR: Esperado <span class="mono">${esperado.dr}</span>, Recebido <span class="mono">${drRecebido}</span>
                        </div>
                    `;
                }
            });
            comparacao.innerHTML = compHtml;
            
            // Status final
            if (todosCorretos) {
                loadStatus.className = 'status success';
                loadStatus.innerHTML = '✅ SUCESSO: Todas as referências estão corretas!';
            } else {
                loadStatus.className = 'status error';
                loadStatus.innerHTML = '❌ ERRO: Algumas referências ainda estão incorretas!';
            }
            
            resultados.style.display = 'block';
        }

        // Aguardar carregamento
        setTimeout(() => {
            validarReferencias();
        }, 1000);
    </script>
</body>
</html>
