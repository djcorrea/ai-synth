<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Teste Direto - Cache Bypass</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: #fff; }
        .result { background: #2a2a2a; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { border-left: 5px solid #4CAF50; }
        .error { border-left: 5px solid #F44336; }
        .warning { border-left: 5px solid #FF9800; }
    </style>
</head>
<body>
    <h1>üî• Teste Direto - Sub-Scores Corrigidos</h1>
    <div id="status">Carregando...</div>
    <div id="results"></div>

    <script>
        const statusDiv = document.getElementById('status');
        const resultsDiv = document.getElementById('results');
        
        // For√ßar cache bypass com timestamp √∫nico
        const timestamp = Date.now();
        const script = document.createElement('script');
        script.src = `audio-analyzer-v2.js?v=FIXED-${timestamp}&cache=bypass`;
        
        script.onload = function() {
            statusDiv.innerHTML = '<div class="result success">‚úÖ AudioAnalyzerV2 carregado com cache bypass</div>';
            
            try {
                if (!window.AudioAnalyzerV2) {
                    throw new Error('AudioAnalyzerV2 n√£o encontrado');
                }
                
                const analyzer = new window.AudioAnalyzerV2();
                
                if (typeof analyzer.calculateQualityScores !== 'function') {
                    throw new Error('M√©todo calculateQualityScores n√£o encontrado - ainda √© vers√£o antiga');
                }
                
                statusDiv.innerHTML += '<div class="result success">‚úÖ M√©todo calculateQualityScores encontrado</div>';
                
                // Teste com dados do caso problem√°tico
                const metrics = {
                    core: { 
                        dynamicRange: 12.5, 
                        spectralCentroid: 2200, 
                        clippingPercentage: 0.001, 
                        dcOffset: 0.002, 
                        peak: 0.0 
                    },
                    loudness: { lufs_integrated: -0.5 },
                    truePeak: { 
                        exceeds_minus1dbtp: true,
                        dbtp: 0.0 
                    },
                    stereo: { 
                        monoCompatibility: 'good', 
                        width: 1.2, 
                        balance: 0.05 
                    }
                };
                
                const result = analyzer.calculateQualityScores(metrics);
                
                const loudnessOK = result.breakdown.loudness <= 20;
                const technicalOK = result.breakdown.technical <= 50;
                
                resultsDiv.innerHTML = `
                    <div class="result ${loudnessOK ? 'success' : 'error'}">
                        <h3>Loudness Score: ${result.breakdown.loudness}/100</h3>
                        <p>${loudnessOK ? '‚úÖ CORRETO' : '‚ùå INCORRETO'} (esperado ‚â§ 20)</p>
                    </div>
                    
                    <div class="result ${technicalOK ? 'success' : 'error'}">
                        <h3>Technical Score: ${result.breakdown.technical}/100</h3>
                        <p>${technicalOK ? '‚úÖ CORRETO' : '‚ùå INCORRETO'} (esperado ‚â§ 50)</p>
                    </div>
                    
                    <div class="result">
                        <h3>Overall Score: ${result.overall}/100</h3>
                    </div>
                    
                    <div class="result ${loudnessOK && technicalOK ? 'success' : 'error'}">
                        <h3>${loudnessOK && technicalOK ? 'üéâ CORRE√á√ÉO CONFIRMADA!' : '‚ö†Ô∏è AINDA H√Å PROBLEMAS'}</h3>
                        <p>${loudnessOK && technicalOK ? 
                            'Os sub-scores agora est√£o precisos. A interface principal deve mostrar os valores corretos.' :
                            'Os sub-scores ainda n√£o est√£o corretos. Verifique se o cache foi limpo.'
                        }</p>
                    </div>
                `;
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="result error"><h3>‚ùå Erro: ${error.message}</h3></div>`;
            }
        };
        
        script.onerror = function() {
            statusDiv.innerHTML = '<div class="result error">‚ùå Falha ao carregar AudioAnalyzerV2</div>';
        };
        
        document.head.appendChild(script);
    </script>
</body>
</html>
