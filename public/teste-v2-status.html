<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Status V2 Auto-Ativa√ß√£o</title>
    <style>
        body { 
            font-family: 'Courier New', monospace; 
            background: #000; 
            color: #00ff00; 
            padding: 20px; 
        }
        .button {
            background: #002200;
            color: #00ff00;
            border: 2px solid #00ff00;
            padding: 15px 30px;
            margin: 10px;
            border-radius: 5px;
            cursor: pointer;
            display: inline-block;
            font-size: 16px;
            font-weight: bold;
        }
        .button:hover { background: #004400; }
        .result {
            background: rgba(0,255,0,0.1);
            border: 1px solid #00ff00;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            white-space: pre-wrap;
        }
        .success { border-color: #00ff00; background: rgba(0,255,0,0.2); }
        .error { border-color: #ff0000; background: rgba(255,0,0,0.1); color: #ff6666; }
        .warning { border-color: #ffff00; background: rgba(255,255,0,0.1); color: #ffff88; }
        .header {
            border-color: #00ffff;
            background: rgba(0,255,255,0.1);
            color: #00ffff;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>üìä TESTE STATUS V2 AUTO-ATIVA√á√ÉO</h1>
    
    <div class="button" onclick="checkCompleteStatus()">Status Completo</div>
    <div class="button" onclick="testQuickScore()">Teste R√°pido Score</div>
    <div class="button" onclick="testAutoActivation()">Teste Auto-Ativa√ß√£o</div>
    <div class="button" onclick="clearResults()">Limpar</div>
    
    <div id="results"></div>

    <!-- Carregar os sistemas na ordem correta -->
    <script src="scoring-v2-complete.js?v=20250823-final"></script>
    <script src="auto-enable-v2.js?v=20250823-final"></script>

    <script>
        function addResult(message, type = 'result') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            document.getElementById('results').appendChild(div);
            console.log(message);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        function checkCompleteStatus() {
            addResult('üîç VERIFICA√á√ÉO COMPLETA DO SISTEMA', 'header');
            
            // 1. Verificar se V2 est√° carregado
            if (window.ScoringV2Complete) {
                addResult('‚úÖ ScoringV2Complete carregado', 'success');
                
                // 2. Verificar status interno
                if (typeof window.ScoringV2Complete.getStatus === 'function') {
                    const status = window.ScoringV2Complete.getStatus();
                    addResult('üìä Status Interno:', 'header');
                    addResult(`   Modo atual: ${status.currentMode}`, 'result');
                    addResult(`   V2 dispon√≠vel: ${status.v2Available}`, 'result');
                    addResult(`   Padr√£o √© V2: ${status.defaultIsV2}`, 'result');
                    addResult(`   Flag de teste: ${status.v2TestFlag}`, 'result');
                    addResult(`   Flag desabilitado: ${status.v2DisabledFlag}`, 'result');
                    
                    if (status.currentMode === 'v2') {
                        addResult('üéâ V2 est√° ATIVO por padr√£o!', 'success');
                    } else {
                        addResult('‚ö†Ô∏è V2 N√ÉO est√° ativo por padr√£o', 'warning');
                    }
                } else {
                    addResult('‚ùå Fun√ß√£o getStatus n√£o encontrada', 'error');
                }
                
                // 3. Verificar fun√ß√µes dispon√≠veis
                addResult('üîß Fun√ß√µes Dispon√≠veis:', 'header');
                const functions = [
                    'computeMixScore',
                    'getStatus',
                    'enableV2Default',
                    'disableV2Default',
                    'checkV2Status'
                ];
                
                functions.forEach(func => {
                    if (typeof window.ScoringV2Complete[func] === 'function') {
                        addResult(`   ‚úÖ ${func}`, 'success');
                    } else {
                        addResult(`   ‚ùå ${func}`, 'error');
                    }
                });
                
            } else {
                addResult('‚ùå ScoringV2Complete N√ÉO carregado', 'error');
            }
            
            // 4. Verificar auto-ativador
            if (window.autoEnableV2) {
                addResult('‚úÖ Auto-ativador carregado', 'success');
            } else {
                addResult('‚ùå Auto-ativador N√ÉO carregado', 'error');
            }
            
            // 5. Verificar flags globais
            addResult('üåê Flags Globais:', 'header');
            addResult(`   window.SCORING_V2_TEST: ${window.SCORING_V2_TEST}`, 'result');
            addResult(`   window.SCORING_V2_DISABLED: ${window.SCORING_V2_DISABLED}`, 'result');
        }

        async function testQuickScore() {
            addResult('‚ö° TESTE R√ÅPIDO DE SCORE', 'header');
            
            if (!window.ScoringV2Complete) {
                addResult('‚ùå Sistema V2 n√£o carregado', 'error');
                return;
            }
            
            const testData = {
                lufsIntegrated: -12.5,
                truePeakDbtp: -0.8,
                dynamicRange: 6.2,
                lra: 4.5,
                stereoCorrelation: 0.75,
                dcOffset: 0.0001,
                clippingPercent: 0,
                bandEnergies: {
                    sub_bass: { rms_db: -8.2 },
                    bass: { rms_db: -6.8 },
                    low_mid: { rms_db: -7.5 },
                    mid: { rms_db: -9.1 },
                    high_mid: { rms_db: -12.3 },
                    treble: { rms_db: -15.6 }
                }
            };
            
            const reference = { genre: 'funk_mandela' };
            
            try {
                const result = await window.ScoringV2Complete.computeMixScore(testData, reference);
                
                addResult(`üéØ Score: ${result.scorePct}%`, 'success');
                addResult(`üîß M√©todo: ${result.method}`, 'result');
                addResult(`üè∑Ô∏è Classifica√ß√£o: ${result.classification}`, 'result');
                addResult(`‚è±Ô∏è Tempo: ${result.processingTime}ms`, 'result');
                
                if (result.scoringVersion) {
                    addResult(`üìä Vers√£o: ${result.scoringVersion}`, 'result');
                }
                
                if (result.method && result.method.includes('v2')) {
                    addResult('üéâ V2 FUNCIONANDO AUTOMATICAMENTE!', 'success');
                } else {
                    addResult('‚ö†Ô∏è V2 n√£o foi usado (ainda usando V1)', 'warning');
                }
                
            } catch (error) {
                addResult(`‚ùå Erro no teste: ${error.message}`, 'error');
            }
        }

        async function testAutoActivation() {
            addResult('üîÑ TESTE DE AUTO-ATIVA√á√ÉO', 'header');
            
            // Simular carregamento da p√°gina
            if (window.autoEnableV2) {
                addResult('üöÄ Executando auto-ativa√ß√£o...', 'result');
                try {
                    await window.autoEnableV2();
                    addResult('‚úÖ Auto-ativa√ß√£o executada', 'success');
                    
                    // Verificar se funcionou
                    if (window.ScoringV2Complete) {
                        const status = window.ScoringV2Complete.getStatus();
                        if (status.currentMode === 'v2') {
                            addResult('üéâ V2 ativado automaticamente!', 'success');
                        } else {
                            addResult('‚ö†Ô∏è Auto-ativa√ß√£o n√£o funcionou', 'warning');
                        }
                    }
                } catch (error) {
                    addResult(`‚ùå Erro na auto-ativa√ß√£o: ${error.message}`, 'error');
                }
            } else {
                addResult('‚ùå Fun√ß√£o autoEnableV2 n√£o encontrada', 'error');
            }
        }

        // Verificar carregamento inicial
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                addResult('üåü SISTEMA CARREGADO', 'header');
                if (window.ScoringV2Complete) {
                    addResult('‚úÖ V2 System OK', 'success');
                } else {
                    addResult('‚ùå V2 System FALHOU', 'error');
                }
                
                if (window.autoEnableV2) {
                    addResult('‚úÖ Auto-ativador OK', 'success');
                } else {
                    addResult('‚ùå Auto-ativador FALHOU', 'error');
                }
                
                addResult('üí° Use "Status Completo" para diagn√≥stico detalhado', 'result');
            }, 500);
        });
    </script>
</body>
</html>
