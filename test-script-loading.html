<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß TESTE DIRETO: Script Loading</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #00ff00; }
        .log { background: #000; padding: 10px; margin: 10px 0; border-left: 3px solid #00ff00; }
        .error { border-color: #ff0000; color: #ff0000; }
        .success { border-color: #00ff00; color: #00ff00; }
        .warning { border-color: #ffaa00; color: #ffaa00; }
        .info { border-color: #0088ff; color: #0088ff; }
    </style>
</head>
<body>
    <h1>üîß TESTE DIRETO: Script Loading</h1>
    <p>Testando carregamento dos scripts passo a passo...</p>
    
    <div id="results"></div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const logDiv = document.createElement('div');
            logDiv.className = `log ${type}`;
            logDiv.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            results.appendChild(logDiv);
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        // Capturar erros JavaScript
        window.addEventListener('error', function(e) {
            log(`‚ùå ERRO JS: ${e.message} (${e.filename}:${e.lineno})`, 'error');
        });

        log('üöÄ P√°gina iniciada, carregando refs...', 'info');
    </script>

    <!-- Carregar refs primeiro -->
    <script src="refs/embedded-refs.js" onload="log('‚úÖ embedded-refs.js carregado', 'success')" onerror="log('‚ùå ERRO ao carregar embedded-refs.js', 'error')"></script>
    
    <script>
        log('üìö Verificando refs carregadas...', 'info');
        
        setTimeout(() => {
            if (window.EMBEDDED_REFS_VERSION) {
                log(`‚úÖ EMBEDDED_REFS_VERSION: ${window.EMBEDDED_REFS_VERSION}`, 'success');
            } else {
                log('‚ùå EMBEDDED_REFS_VERSION n√£o encontrado', 'error');
            }
            
            if (window.PROD_AI_REF_DATA) {
                log(`‚úÖ PROD_AI_REF_DATA: ${Object.keys(window.PROD_AI_REF_DATA).length} g√™neros`, 'success');
            } else {
                log('‚ùå PROD_AI_REF_DATA n√£o encontrado', 'error');
            }
        }, 100);
    </script>

    <!-- Carregar audio-analyzer depois -->
    <script src="audio-analyzer.js" onload="log('‚úÖ audio-analyzer.js carregado', 'success')" onerror="log('‚ùå ERRO ao carregar audio-analyzer.js', 'error')"></script>
    
    <script>
        log('üéµ Verificando audio-analyzer carregado...', 'info');
        
        setTimeout(() => {
            // Verificar vari√°veis b√°sicas
            if (typeof AudioAnalyzer !== 'undefined') {
                log('‚úÖ AudioAnalyzer dispon√≠vel', 'success');
            } else {
                log('‚ùå AudioAnalyzer n√£o encontrado', 'error');
            }
            
            if (window.NEW_CACHE_KEY !== undefined) {
                log(`‚úÖ NEW_CACHE_KEY: ${window.NEW_CACHE_KEY}`, 'success');
            } else {
                log('‚ùå NEW_CACHE_KEY n√£o encontrado', 'error');
            }
            
            // Verificar se console.log do script foi executado
            log('üîç Verificando se scripts foram executados completamente...', 'info');
            
            // Tentar executar uma fun√ß√£o simples do AudioAnalyzer
            try {
                const analyzer = new AudioAnalyzer();
                log('‚úÖ AudioAnalyzer pode ser instanciado', 'success');
            } catch (e) {
                log(`‚ùå Erro ao instanciar AudioAnalyzer: ${e.message}`, 'error');
            }
            
        }, 500);
    </script>

    <script>
        // Verifica√ß√£o final das fun√ß√µes
        setTimeout(() => {
            log('üîç VERIFICA√á√ÉO FINAL DAS FUN√á√ïES...', 'info');
            
            const functions = [
                'invalidateAudioAnalysisCache',
                'invalidateCacheByChange', 
                '_cacheChangeMonitor'
            ];
            
            functions.forEach(fn => {
                const exists = window[fn] !== undefined;
                const type = typeof window[fn];
                log(`${exists ? '‚úÖ' : '‚ùå'} ${fn}: ${type}`, exists ? 'success' : 'error');
                
                if (exists && typeof window[fn] === 'function') {
                    try {
                        // Tentar executar fun√ß√£o b√°sica
                        if (fn === 'invalidateAudioAnalysisCache') {
                            const result = window[fn]();
                            log(`‚úÖ ${fn} executada: ${JSON.stringify(result)}`, 'success');
                        }
                    } catch (e) {
                        log(`‚ùå Erro ao executar ${fn}: ${e.message}`, 'error');
                    }
                }
            });
            
            // Verificar se h√° cache map
            if (window.__AUDIO_ANALYSIS_CACHE__) {
                log(`‚úÖ __AUDIO_ANALYSIS_CACHE__ existe: ${window.__AUDIO_ANALYSIS_CACHE__.constructor.name}`, 'success');
            } else {
                log('‚ÑπÔ∏è __AUDIO_ANALYSIS_CACHE__ n√£o existe (normal se nunca houve an√°lise)', 'info');
            }
            
        }, 1000);
    </script>
</body>
</html>
