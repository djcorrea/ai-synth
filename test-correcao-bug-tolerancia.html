<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Corre√ß√£o Bug Toler√¢ncia</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #fff;
            padding: 20px;
            margin: 0;
        }
        
        .test-case {
            background: #2a2a2a;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #00ff88;
        }
        
        .error {
            background: #4a2a2a;
            border-left-color: #ff4757;
        }
        
        .success {
            background: #2a4a2a;
            border-left-color: #52f7ad;
        }
        
        .code {
            background: #333;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
        }
        
        .before {
            color: #ff6b6b;
        }
        
        .after {
            color: #51cf66;
        }
        
        h1 {
            color: #00ff88;
            text-align: center;
        }
        
        h2 {
            color: #ffd93d;
        }
        
        .test-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
        }
        
        .pass {
            background: #1f4d28;
            color: #52f7ad;
        }
        
        .fail {
            background: #4d1f1f;
            color: #ff4757;
        }
    </style>
</head>
<body>
    <h1>üîß Teste - Corre√ß√£o do Bug das Toler√¢ncias</h1>
    
    <div class="test-case">
        <h2>üìù Problema Identificado</h2>
        <p>O sistema estava usando <code>Math.min(baseMag, sideTol)</code> nas sugest√µes de ajuste, o que causava:</p>
        <ul>
            <li>Low_bass: diferen√ßa real 16dB ‚Üí sugest√£o incorreta 1.7dB (toler√¢ncia)</li>
            <li>Mid: diferen√ßa real 7.45dB ‚Üí sugest√£o incorreta 2.3dB (toler√¢ncia)</li>
        </ul>
    </div>
    
    <div class="test-case">
        <h2>‚ö†Ô∏è C√≥digo Problem√°tico (ANTES)</h2>
        <div class="code before">
if (band === 'high_mid') action = `High-mid acima do alvo (+${baseMag.toFixed(1)}dB). Considere reduzir ~${Math.min(baseMag, sideTol).toFixed(1)} dB em 2‚Äì6 kHz`;
        </div>
        <p>‚ùå Quando <code>baseMag > sideTol</code>, usava a toler√¢ncia em vez da diferen√ßa real!</p>
    </div>
    
    <div class="test-case success">
        <h2>‚úÖ C√≥digo Corrigido (DEPOIS)</h2>
        <div class="code after">
if (band === 'high_mid') action = `High-mid acima do alvo (+${baseMag.toFixed(1)}dB). Considere reduzir ~${baseMag.toFixed(1)} dB em 2‚Äì6 kHz`;
        </div>
        <p>‚úÖ Agora sempre usa <code>baseMag</code> (diferen√ßa real) nas sugest√µes!</p>
    </div>
    
    <div class="test-case">
        <h2>üß™ Simula√ß√£o dos Casos Reportados</h2>
        <div id="simulacao"></div>
    </div>

    <script>
        function simularSugestoes() {
            const casos = [
                {
                    banda: 'low_bass',
                    valorAtual: -1.4, // Exemplo do usu√°rio  
                    valorAlvo: -14.6, // Target funk_mandela
                    tolerancia: 1.66,  // tol_db funk_mandela low_bass
                    diferencaReal: 13.2 // ~16dB como reportado
                },
                {
                    banda: 'mid',
                    valorAtual: 10.75, // Exemplo do usu√°rio
                    valorAlvo: 3.3,    // Target funk_mandela mid
                    tolerancia: 2.3,   // tol_db funk_mandela mid
                    diferencaReal: 7.45 // Como reportado
                }
            ];
            
            let html = '';
            
            casos.forEach((caso, i) => {
                const baseMag = Math.abs(caso.diferencaReal);
                const sideTol = caso.tolerancia;
                
                // Simula√ß√£o do c√≥digo ANTES (bugado)
                const sugestaoAntiga = Math.min(baseMag, sideTol).toFixed(1);
                
                // Simula√ß√£o do c√≥digo DEPOIS (corrigido)
                const sugestaoCorrigida = baseMag.toFixed(1);
                
                html += `
                    <div style="background: #333; padding: 15px; margin: 10px 0; border-radius: 8px;">
                        <h3>Caso ${i + 1}: Banda ${caso.banda}</h3>
                        <p><strong>Atual:</strong> ${caso.valorAtual}dB | <strong>Alvo:</strong> ${caso.valorAlvo}dB | <strong>Diferen√ßa Real:</strong> ${caso.diferencaReal}dB</p>
                        <p><strong>Toler√¢ncia:</strong> ¬±${caso.tolerancia}dB</p>
                        
                        <div class="test-result fail">
                            <strong>‚ùå ANTES (bugado):</strong> Sugest√£o ${sugestaoAntiga}dB<br>
                            <em>Usava Math.min(${baseMag.toFixed(1)}, ${sideTol}) = ${sugestaoAntiga}dB</em>
                        </div>
                        
                        <div class="test-result pass">
                            <strong>‚úÖ DEPOIS (corrigido):</strong> Sugest√£o ${sugestaoCorrigida}dB<br>
                            <em>Usa baseMag = ${sugestaoCorrigida}dB (diferen√ßa real)</em>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('simulacao').innerHTML = html;
        }
        
        // Executar simula√ß√£o ao carregar
        simularSugestoes();
        
        console.log('üîß Teste de corre√ß√£o carregado');
        console.log('üìä Casos simulados baseados no problema reportado pelo usu√°rio');
    </script>
</body>
</html>
