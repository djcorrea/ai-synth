<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Teste: Problemas T√©cnicos Inteligentes</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .test-case { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .clean { border-left: 4px solid #4CAF50; background: rgba(76, 175, 80, 0.1); }
        .problems { border-left: 4px solid #F44336; background: rgba(244, 67, 54, 0.1); }
        .result { margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-family: monospace; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste: Sistema Inteligente de Problemas T√©cnicos</h1>
        
        <div class="test-case clean">
            <h2>‚úÖ Caso 1: √Åudio Limpo (Sem Problemas)</h2>
            <p><strong>Cen√°rio:</strong> √Åudio bem produzido, sem clipping, DC offset baixo</p>
            <div id="test1" class="result">Testando...</div>
        </div>
        
        <div class="test-case problems">
            <h2>üö® Caso 2: √Åudio com Clipping</h2>
            <p><strong>Cen√°rio:</strong> √Åudio com 150 samples de clipping</p>
            <div id="test2" class="result">Testando...</div>
        </div>
        
        <div class="test-case problems">
            <h2>‚ö†Ô∏è Caso 3: √Åudio com DC Offset</h2>
            <p><strong>Cen√°rio:</strong> √Åudio com DC offset significativo</p>
            <div id="test3" class="result">Testando...</div>
        </div>
        
        <div class="test-case problems">
            <h2>üîÑ Caso 4: Problemas M√∫ltiplos</h2>
            <p><strong>Cen√°rio:</strong> Clipping + DC Offset + THD alto</p>
            <div id="test4" class="result">Testando...</div>
        </div>
    </div>

    <script>
        // Simular a fun√ß√£o techProblems com diferentes cen√°rios
        function simulateTechProblems(analysisData) {
            const analysis = analysisData;
            const safeFixed = (val, decimals) => Number.isFinite(val) ? val.toFixed(decimals) : '0';
            const row = (label, value) => `${label}: ${value}\\n`;
            
            const rows = [];
            let hasProblems = false;
            
            // Clipping - s√≥ mostrar se > 0
            const clipVal = Number.isFinite(analysis.technicalData?.clippingSamples) ? analysis.technicalData.clippingSamples : 0;
            const clipPct = Number.isFinite(analysis.technicalData?.clippingPct) ? analysis.technicalData.clippingPct : 0;
            if (clipVal > 0 || clipPct > 0) {
                const clipText = clipPct > 0 ? `${clipPct.toFixed(2)}% (${clipVal} samples)` : `${clipVal} samples`;
                rows.push(row('Clipping', clipText));
                hasProblems = true;
            }
            
            // DC Offset - s√≥ mostrar se significativo
            const dcVal = Number.isFinite(analysis.technicalData?.dcOffset) ? analysis.technicalData.dcOffset : 0;
            if (Math.abs(dcVal) > 0.01) {
                rows.push(row('DC Offset', safeFixed(dcVal, 4)));
                hasProblems = true;
            }
            
            // THD - s√≥ mostrar se alto
            const thdVal = Number.isFinite(analysis.technicalData?.thdPercent) ? analysis.technicalData.thdPercent : 0;
            if (thdVal > 1.0) {
                rows.push(row('THD', `${safeFixed(thdVal, 2)}%`));
                hasProblems = true;
            }
            
            // Stereo correlation - s√≥ mostrar se problem√°tico
            const stereoCorr = Number.isFinite(analysis.technicalData?.stereoCorrelation) ? analysis.technicalData.stereoCorrelation : null;
            if (stereoCorr !== null && (stereoCorr < -0.3 || stereoCorr > 0.95)) {
                const status = stereoCorr < -0.3 ? 'Fora de fase' : 'Mono demais';
                rows.push(row('Stereo Corr.', `${safeFixed(stereoCorr, 3)} (${status})`));
                hasProblems = true;
            }
            
            // Consist√™ncia (simulada)
            if (analysis.metricsValidation && Object.keys(analysis.metricsValidation).length) {
                const mv = analysis.metricsValidation;
                
                if (mv.dynamicRangeConsistency && mv.dynamicRangeConsistency !== 'ok') {
                    rows.push(row('DR Consist√™ncia', `Œî=${mv.dynamicRangeDelta} (${mv.dynamicRangeConsistency})`));
                    hasProblems = true;
                }
                if (mv.crestFactorConsistency && mv.crestFactorConsistency !== 'ok') {
                    rows.push(row('Crest Consist.', `Œî=${mv.crestVsExpectedDelta} (${mv.crestFactorConsistency})`));
                    hasProblems = true;
                }
                if (mv.lraPlausibility && mv.lraPlausibility !== 'ok') {
                    rows.push(row('LRA Plaus√≠vel', mv.lraPlausibility));
                    hasProblems = true;
                }
            }
            
            // Se n√£o h√° problemas, mostrar mensagem positiva
            if (!hasProblems) {
                return "‚úÖ Nenhum Problema T√©cnico Detectado\\nSeu √°udio est√° tecnicamente limpo";
            }
            
            return rows.join('');
        }
        
        // Teste 1: √Åudio limpo
        const cleanAudio = {
            technicalData: {
                clippingSamples: 0,
                clippingPct: 0,
                dcOffset: 0.0001,
                thdPercent: 0.1,
                stereoCorrelation: 0.3
            },
            metricsValidation: {}
        };
        
        // Teste 2: √Åudio com clipping
        const clippingAudio = {
            technicalData: {
                clippingSamples: 150,
                clippingPct: 0.25,
                dcOffset: 0.0001,
                thdPercent: 0.1,
                stereoCorrelation: 0.3
            },
            metricsValidation: {}
        };
        
        // Teste 3: √Åudio com DC offset
        const dcOffsetAudio = {
            technicalData: {
                clippingSamples: 0,
                clippingPct: 0,
                dcOffset: 0.05,
                thdPercent: 0.1,
                stereoCorrelation: 0.3
            },
            metricsValidation: {}
        };
        
        // Teste 4: M√∫ltiplos problemas
        const multipleProblems = {
            technicalData: {
                clippingSamples: 89,
                clippingPct: 0.15,
                dcOffset: 0.03,
                thdPercent: 2.5,
                stereoCorrelation: -0.4
            },
            metricsValidation: {
                dynamicRangeConsistency: 'warn',
                dynamicRangeDelta: '5.2',
                crestFactorConsistency: 'ok'
            }
        };
        
        // Executar testes
        document.getElementById('test1').textContent = simulateTechProblems(cleanAudio);
        document.getElementById('test2').textContent = simulateTechProblems(clippingAudio);
        document.getElementById('test3').textContent = simulateTechProblems(dcOffsetAudio);
        document.getElementById('test4').textContent = simulateTechProblems(multipleProblems);
    </script>
</body>
</html>
