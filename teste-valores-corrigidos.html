<!DOCTYPE html>
<html>
<head>
    <title>Teste Valores Funk Mandela Corrigidos</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #fff; }
        .correto { color: #0f5132; background: #d1e7dd; padding: 5px; }
        .incorreto { color: #842029; background: #f8d7da; padding: 5px; }
        .banda { margin: 10px 0; padding: 10px; border: 1px solid #555; }
        .valor { font-size: 18px; font-weight: bold; }
    </style>
</head>
<body>
    <h1>üîß TESTE: Valores Funk Mandela Corrigidos (v2.0)</h1>
    
    <h2>üìä Status das Corre√ß√µes</h2>
    <div id="status">‚è≥ Carregando...</div>
    
    <h2>üéµ Valores das Bandas Espectrais</h2>
    <div id="bandas">‚è≥ Carregando dados...</div>

    <script src="public/refs/embedded-refs.js"></script>
    <script src="public/audio-analyzer-integration.js"></script>
    <script>
        // For√ßar bypass de cache
        window.REFS_BYPASS_CACHE = true;
        
        function testarValores() {
            console.log('üîß Testando valores funk_mandela...');
            
            // Verificar dados embutidos
            const embeddedData = window.__EMBEDDED_REFS__?.byGenre?.funk_mandela;
            const inlineData = __INLINE_EMBEDDED_REFS__?.byGenre?.funk_mandela;
            
            console.log('üìä Embedded data:', embeddedData);
            console.log('üìä Inline data:', inlineData);
            
            const dados = embeddedData || inlineData;
            
            if (!dados) {
                document.getElementById('status').innerHTML = 
                    '<div class="incorreto">‚ùå ERRO: Nenhum dado encontrado!</div>';
                return;
            }
            
            // Verificar vers√£o
            const versao = dados.version || 'v1.0';
            const metodo = dados.aggregation_method || 'dB_domain_legacy';
            
            let statusHtml = `
                <div class="banda">
                    <strong>Vers√£o:</strong> ${versao}<br>
                    <strong>M√©todo:</strong> ${metodo}<br>
                    <strong>Faixas:</strong> ${dados.num_tracks || 'N/A'}
                </div>
            `;
            
            // Verificar valores das bandas
            const bandas = dados.bands || {};
            let bandasHtml = '';
            let todosCorretos = true;
            
            for (const [banda, valores] of Object.entries(bandas)) {
                const target = valores.target_db;
                const correto = target !== null && target !== undefined && target < 0;
                
                const classe = correto ? 'correto' : 'incorreto';
                const emoji = correto ? '‚úÖ' : '‚ùå';
                
                if (!correto) todosCorretos = false;
                
                bandasHtml += `
                    <div class="banda ${classe}">
                        <strong>${banda}:</strong> 
                        <span class="valor">${target} dB</span> 
                        ${emoji} ${correto ? 'CORRETO' : 'INCORRETO - VALOR POSITIVO!'}
                        <br><small>Toler√¢ncia: ¬±${valores.tol_db} dB</small>
                    </div>
                `;
            }
            
            if (todosCorretos && versao === 'v2.0') {
                statusHtml += '<div class="correto">üéâ CORRE√á√ÉO FUNCIONOU! Todos os valores est√£o corretos.</div>';
            } else {
                statusHtml += '<div class="incorreto">‚ö†Ô∏è PROBLEMA DETECTADO! Valores ainda incorretos ou vers√£o antiga.</div>';
            }
            
            document.getElementById('status').innerHTML = statusHtml;
            document.getElementById('bandas').innerHTML = bandasHtml;
            
            // Log para debug
            console.log('üîß Resultado do teste:', { 
                versao, 
                metodo, 
                todosCorretos, 
                bandas 
            });
        }
        
        // Executar teste ap√≥s carregamento
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(testarValores, 100);
        });
        
        // Tamb√©m executar imediatamente
        testarValores();
    </script>
</body>
</html>
