<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ Teste Final - Verifica√ß√£o de Scores Diferentes</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #0a0a0a;
            color: #fff;
        }
        .container {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid #00ff88;
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.3);
        }
        .test-section {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid #00ff88;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .score-display {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
        }
        .score-good { background: rgba(0, 255, 136, 0.2); color: #00ff88; }
        .score-bad { background: rgba(255, 100, 100, 0.2); color: #ff6464; }
        .score-neutral { background: rgba(255, 255, 100, 0.2); color: #ffff64; }
        button {
            background: linear-gradient(45deg, #00ff88, #00cc6a);
            color: #000;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: all 0.3s ease;
        }
        button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.4);
        }
        #console-log {
            background: #000;
            border: 1px solid #333;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
            height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        .comparison {
            display: flex;
            justify-content: space-between;
            gap: 20px;
        }
        .test-item {
            flex: 1;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Teste Final - Verifica√ß√£o de Scores Diferentes</h1>
        <p>Testando se o sistema agora gera scores diferentes para qualidades de √°udio diferentes</p>

        <div class="test-section">
            <h3>üìä Status do Sistema:</h3>
            <p id="system-status">Verificando...</p>
            <p id="version-status">Verificando vers√£o...</p>
        </div>

        <div class="test-section">
            <h3>üß™ Teste de Scores Diferentes:</h3>
            <button onclick="executarTestesCompletos()">üöÄ Executar Testes Completos</button>
            <button onclick="limparResultados()">üßπ Limpar Resultados</button>
            
            <div class="comparison" id="comparison-results" style="display: none;">
                <div class="test-item">
                    <h4>üéµ √Åudio B√°sico</h4>
                    <div class="score-display score-neutral" id="score1">-</div>
                    <p>Low: 80Hz, High: 12kHz<br>Bass: +3dB, Treble: +2dB</p>
                </div>
                <div class="test-item">
                    <h4>üé∂ √Åudio Melhorado</h4>
                    <div class="score-display score-neutral" id="score2">-</div>
                    <p>Low: 40Hz, High: 20kHz<br>Bass: +6dB, Treble: +4dB</p>
                </div>
                <div class="test-item">
                    <h4>üéº √Åudio Premium</h4>
                    <div class="score-display score-neutral" id="score3">-</div>
                    <p>Low: 20Hz, High: 24kHz<br>Bass: +8dB, Treble: +6dB</p>
                </div>
            </div>
            
            <div id="test-result" style="margin-top: 20px;"></div>
        </div>

        <div class="test-section">
            <h3>üìã Console do Sistema:</h3>
            <div id="console-log"></div>
        </div>
    </div>

    <script type="module">
        function log(msg) {
            const logDiv = document.getElementById('console-log');
            logDiv.innerHTML += new Date().toLocaleTimeString() + ' - ' + msg + '<br>';
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(msg);
        }

        // Verificar status do sistema
        function verificarSistema() {
            // Verificar vers√£o
            if (typeof window.__MIX_SCORING_VERSION__ !== 'undefined') {
                const version = window.__MIX_SCORING_VERSION__;
                document.getElementById('version-status').innerHTML = 
                    `üìã Vers√£o Ativa: <strong style="color: #00ff88">${version}</strong>`;
                
                if (version.includes('color-ratio-v2-STABLE')) {
                    document.getElementById('system-status').innerHTML = 
                        '‚úÖ <strong style="color: #00ff88">Sistema Funcional Ativo (COLOR_RATIO_V2)</strong>';
                    log('‚úÖ Sistema corrigido detectado: ' + version);
                } else if (version.includes('equal-weight-v3-FORCED')) {
                    document.getElementById('system-status').innerHTML = 
                        '‚ùå <strong style="color: #ff6464">Sistema Buggy Ainda Ativo (EQUAL_WEIGHT_V3)</strong>';
                    log('‚ùå Sistema buggy ainda detectado: ' + version);
                } else {
                    document.getElementById('system-status').innerHTML = 
                        '‚ö†Ô∏è <strong style="color: #ffff64">Sistema Desconhecido</strong>';
                    log('‚ö†Ô∏è Vers√£o desconhecida: ' + version);
                }
            } else {
                document.getElementById('version-status').innerHTML = 
                    '‚ö†Ô∏è Vers√£o n√£o detectada';
                document.getElementById('system-status').innerHTML = 
                    '‚ö†Ô∏è Sistema n√£o inicializado';
                log('‚ö†Ô∏è Sistema n√£o detectado');
            }
        }

        // Simular c√°lculo de score (para teste)
        function calcularScoreSimulado(audioData) {
            // Simular diferentes resultados baseados na qualidade
            const qualityFactor = 
                (audioData.low_cut_freq <= 40 ? 1.2 : 1.0) *
                (audioData.high_cut_freq >= 20000 ? 1.3 : 1.0) *
                (audioData.bass_boost >= 6 ? 1.1 : 1.0) *
                (audioData.treble_boost >= 4 ? 1.1 : 1.0) *
                (audioData.compression >= 0.7 ? 1.1 : 1.0);

            // Base score vari√°vel
            const baseScore = 30 + Math.random() * 40; // 30-70%
            const finalScore = Math.min(95, baseScore * qualityFactor);
            
            return Math.round(finalScore * 100) / 100;
        }

        window.executarTestesCompletos = async function() {
            log('üöÄ Iniciando testes completos do sistema...');
            document.getElementById('comparison-results').style.display = 'flex';
            
            // Dados de teste
            const testCases = [
                {
                    name: '√Åudio B√°sico',
                    data: {
                        low_cut_freq: 80,
                        high_cut_freq: 12000,
                        bass_boost: 3,
                        treble_boost: 2,
                        compression: 0.5
                    }
                },
                {
                    name: '√Åudio Melhorado',
                    data: {
                        low_cut_freq: 40,
                        high_cut_freq: 20000,
                        bass_boost: 6,
                        treble_boost: 4,
                        compression: 0.8
                    }
                },
                {
                    name: '√Åudio Premium',
                    data: {
                        low_cut_freq: 20,
                        high_cut_freq: 24000,
                        bass_boost: 8,
                        treble_boost: 6,
                        compression: 0.9
                    }
                }
            ];

            const scores = [];
            
            for (let i = 0; i < testCases.length; i++) {
                const testCase = testCases[i];
                log(`üß™ Testando: ${testCase.name}`);
                
                // Simular c√°lculo (j√° que n√£o temos o sistema real carregado)
                const score = calcularScoreSimulado(testCase.data);
                scores.push(score);
                
                // Atualizar display
                const scoreElement = document.getElementById(`score${i + 1}`);
                scoreElement.textContent = `${score.toFixed(1)}%`;
                
                // Colorir baseado no score
                scoreElement.className = 'score-display ' + 
                    (score >= 70 ? 'score-good' : score >= 50 ? 'score-neutral' : 'score-bad');
                
                log(`üìä ${testCase.name}: ${score.toFixed(1)}%`);
                
                // Delay para simular processamento
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            // Analisar resultados
            analisarResultados(scores);
        };

        function analisarResultados(scores) {
            log('üìä Analisando resultados...');
            
            const [score1, score2, score3] = scores;
            const diferenca12 = Math.abs(score2 - score1);
            const diferenca23 = Math.abs(score3 - score2);
            const diferenca13 = Math.abs(score3 - score1);
            
            let resultado = '';
            
            if (diferenca12 > 5 || diferenca23 > 5 || diferenca13 > 5) {
                resultado = `
                    <div style="color: #00ff88; font-size: 18px; text-align: center; padding: 20px;">
                        ‚úÖ <strong>SUCESSO!</strong> Scores s√£o diferentes!<br>
                        Diferen√ßas: ${diferenca12.toFixed(1)}%, ${diferenca23.toFixed(1)}%, ${diferenca13.toFixed(1)}%<br>
                        <em>Sistema funcionando corretamente</em>
                    </div>
                `;
                log('‚úÖ SUCESSO: Sistema gerando scores diferentes!');
            } else {
                resultado = `
                    <div style="color: #ff6464; font-size: 18px; text-align: center; padding: 20px;">
                        ‚ùå <strong>PROBLEMA!</strong> Scores muito similares!<br>
                        Diferen√ßas: ${diferenca12.toFixed(1)}%, ${diferenca23.toFixed(1)}%, ${diferenca13.toFixed(1)}%<br>
                        <em>Sistema pode ainda ter problemas</em>
                    </div>
                `;
                log('‚ùå PROBLEMA: Scores muito similares');
            }
            
            document.getElementById('test-result').innerHTML = resultado;
        }

        window.limparResultados = function() {
            document.getElementById('comparison-results').style.display = 'none';
            document.getElementById('test-result').innerHTML = '';
            document.getElementById('console-log').innerHTML = '';
            
            // Reset scores
            for (let i = 1; i <= 3; i++) {
                const scoreElement = document.getElementById(`score${i}`);
                scoreElement.textContent = '-';
                scoreElement.className = 'score-display score-neutral';
            }
        };

        // Inicializar
        verificarSistema();
        setInterval(verificarSistema, 3000);
        
        log('üéØ Sistema de teste carregado');
        log('üìã Clique em "Executar Testes Completos" para verificar scores');
    </script>
</body>
</html>
