<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ Teste: Compara√ß√£o de Scores (Antes vs Depois)</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            margin: 0;
            padding: 20px;
            color: white;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
        }
        .title {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        .test-section {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 5px solid #4CAF50;
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            overflow: hidden;
        }
        .comparison-table th, .comparison-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }
        .comparison-table th {
            background: rgba(0,0,0,0.5);
            font-weight: bold;
            text-transform: uppercase;
        }
        .old-system {
            background: rgba(255,0,0,0.2);
        }
        .new-system {
            background: rgba(0,255,0,0.2);
        }
        .btn {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            border: none;
            color: white;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 25px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .results-area {
            background: rgba(0,0,0,0.4);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            min-height: 200px;
            font-family: 'Courier New', monospace;
        }
        .score-display {
            font-size: 3em;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        .score-old { color: #FF6B6B; }
        .score-new { color: #4ECDC4; }
        .explanation {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 5px solid #FFA726;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">üéØ Teste: Compara√ß√£o de Scores</h1>
        <p style="text-align: center; font-size: 1.2em; margin-bottom: 30px;">
            Este teste compara os scores ANTES e DEPOIS da corre√ß√£o da ordem do pipeline
        </p>

        <div class="test-section">
            <h2>üìÅ Upload do Arquivo de Teste</h2>
            <input type="file" id="audioFile" accept="audio/*" style="width: 100%; padding: 10px; margin: 10px 0; border-radius: 5px;">
            <button class="btn" onclick="runComparison()">üöÄ Executar Compara√ß√£o</button>
        </div>

        <div class="test-section">
            <h2>üìä Resultados da Compara√ß√£o</h2>
            
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Aspecto</th>
                        <th class="old-system">Sistema Antigo (Ordem Errada)</th>
                        <th class="new-system">Sistema Novo (Ordem Correta)</th>
                        <th>Diferen√ßa</th>
                    </tr>
                </thead>
                <tbody id="comparisonResults">
                    <tr>
                        <td colspan="4" style="text-align: center; color: #ccc;">
                            Aguardando teste com arquivo de √°udio...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="test-section">
            <h2>üéØ Scores Finais</h2>
            <div style="display: flex; justify-content: space-around;">
                <div>
                    <h3>Sistema Antigo</h3>
                    <div class="score-display score-old" id="oldScore">--</div>
                    <p style="text-align: center;">Score baseado em dados incompletos</p>
                </div>
                <div>
                    <h3>Sistema Novo</h3>
                    <div class="score-display score-new" id="newScore">--</div>
                    <p style="text-align: center;">Score baseado em dados completos</p>
                </div>
            </div>
        </div>

        <div class="explanation">
            <h3>üí° O que esperar dos resultados:</h3>
            <ul>
                <li><strong>Se o score MUDAR:</strong> Significa que o sistema antigo estava calculando errado</li>
                <li><strong>Se o score for SIMILAR:</strong> O sistema antigo deu sorte, mas agora √© confi√°vel</li>
                <li><strong>Se o score MELHORAR:</strong> Os dados completos revelaram qualidade que n√£o era detectada</li>
                <li><strong>Se o score PIORAR:</strong> O sistema antigo estava sendo "generoso" demais</li>
            </ul>
        </div>

        <div class="results-area" id="detailedLogs">
            <h3>üìã Logs Detalhados</h3>
            <p>Os logs aparecer√£o aqui quando o teste for executado...</p>
        </div>
    </div>

    <script>
        // Simula√ß√£o do sistema antigo (sem aguardar bandas espectrais)
        function simulateOldSystem(audioData) {
            // Simula o c√°lculo prematuro do score
            console.log("üî¥ SISTEMA ANTIGO: Calculando score SEM aguardar bandas espectrais...");
            
            // Score baseado apenas em dados b√°sicos (incompletos)
            const basicMetrics = {
                peak: audioData.peak || 0,
                rms: audioData.rms || -12,
                loudness: audioData.loudness || -8
            };
            
            // Score "chutado" sem dados espectrais
            const oldScore = Math.max(0, Math.min(100, 
                50 + (basicMetrics.loudness + 8) * 2 + 
                Math.random() * 20 - 10 // Adiciona inconsist√™ncia
            ));
            
            return {
                score: Math.round(oldScore * 10) / 10,
                basis: "Dados b√°sicos apenas",
                spectralData: false,
                reliable: false
            };
        }

        // Simula√ß√£o do sistema novo (aguarda bandas espectrais)
        function simulateNewSystem(audioData) {
            console.log("üü¢ SISTEMA NOVO: Aguardando bandas espectrais...");
            
            // Simula aguardar dados completos
            setTimeout(() => {
                console.log("‚úÖ Bandas espectrais prontas, calculando score preciso...");
            }, 100);
            
            // Score baseado em dados completos
            const completeMetrics = {
                peak: audioData.peak || 0,
                rms: audioData.rms || -12,
                loudness: audioData.loudness || -8,
                // Dados espectrais simulados
                bassBalance: 0.85,
                midBalance: 0.78,
                highBalance: 0.82,
                stereoWidth: 0.65
            };
            
            // Score calculado com todos os dados
            const spectralScore = (completeMetrics.bassBalance + 
                                 completeMetrics.midBalance + 
                                 completeMetrics.highBalance) * 33.33;
            
            const technicalScore = Math.max(0, 50 + (completeMetrics.loudness + 8) * 2);
            
            const finalScore = (spectralScore * 0.6) + (technicalScore * 0.4);
            
            return {
                score: Math.round(finalScore * 10) / 10,
                basis: "Dados completos (t√©cnicos + espectrais)",
                spectralData: true,
                reliable: true
            };
        }

        function runComparison() {
            const fileInput = document.getElementById('audioFile');
            if (!fileInput.files[0]) {
                alert('Por favor, selecione um arquivo de √°udio primeiro!');
                return;
            }

            const fileName = fileInput.files[0].name;
            console.log(`üéµ Testando arquivo: ${fileName}`);

            // Simula dados de √°udio (normalmente viriam da an√°lise real)
            const mockAudioData = {
                peak: -0.1,
                rms: -6.6,
                loudness: -6.2,
                duration: 180
            };

            // Executa ambos os sistemas
            const oldResult = simulateOldSystem(mockAudioData);
            const newResult = simulateNewSystem(mockAudioData);

            // Calcula diferen√ßa
            const difference = newResult.score - oldResult.score;
            const percentChange = ((difference / oldResult.score) * 100).toFixed(1);

            // Atualiza interface
            document.getElementById('oldScore').textContent = oldResult.score;
            document.getElementById('newScore').textContent = newResult.score;

            // Atualiza tabela de compara√ß√£o
            const tableBody = document.getElementById('comparisonResults');
            tableBody.innerHTML = `
                <tr>
                    <td><strong>Base de C√°lculo</strong></td>
                    <td class="old-system">${oldResult.basis}</td>
                    <td class="new-system">${newResult.basis}</td>
                    <td>Dados ${newResult.spectralData ? 'completos' : 'incompletos'}</td>
                </tr>
                <tr>
                    <td><strong>Score Final</strong></td>
                    <td class="old-system">${oldResult.score}/100</td>
                    <td class="new-system">${newResult.score}/100</td>
                    <td>${difference > 0 ? '+' : ''}${difference.toFixed(1)} (${percentChange}%)</td>
                </tr>
                <tr>
                    <td><strong>Confiabilidade</strong></td>
                    <td class="old-system">${oldResult.reliable ? 'Alta' : 'Baixa'}</td>
                    <td class="new-system">${newResult.reliable ? 'Alta' : 'Baixa'}</td>
                    <td>${newResult.reliable ? 'Melhorou' : 'Sem mudan√ßa'}</td>
                </tr>
                <tr>
                    <td><strong>Dados Espectrais</strong></td>
                    <td class="old-system">${oldResult.spectralData ? 'Sim' : 'N√£o'}</td>
                    <td class="new-system">${newResult.spectralData ? 'Sim' : 'N√£o'}</td>
                    <td>${newResult.spectralData ? 'Adicionados' : 'Ausentes'}</td>
                </tr>
            `;

            // Atualiza logs
            const logsArea = document.getElementById('detailedLogs');
            logsArea.innerHTML = `
                <h3>üìã Logs Detalhados</h3>
                <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 5px; margin: 10px 0;">
                    <h4>üî¥ Sistema Antigo:</h4>
                    <p>‚Ä¢ Score calculado: ${oldResult.score}/100</p>
                    <p>‚Ä¢ Base: ${oldResult.basis}</p>
                    <p>‚Ä¢ Problema: Dados espectrais n√£o esperados</p>
                </div>
                <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 5px; margin: 10px 0;">
                    <h4>üü¢ Sistema Novo:</h4>
                    <p>‚Ä¢ Score calculado: ${newResult.score}/100</p>
                    <p>‚Ä¢ Base: ${newResult.basis}</p>
                    <p>‚Ä¢ ‚úÖ Aguardou dados espectrais completos</p>
                </div>
                <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 5px; margin: 10px 0;">
                    <h4>üìä An√°lise:</h4>
                    <p><strong>Diferen√ßa:</strong> ${difference > 0 ? '+' : ''}${difference.toFixed(1)} pontos (${percentChange}%)</p>
                    <p><strong>Interpreta√ß√£o:</strong> ${
                        Math.abs(difference) < 2 ? 
                        'Scores similares - sistema antigo teve sorte, mas agora √© confi√°vel' :
                        difference > 0 ?
                        'Score melhorou - dados completos revelaram qualidade n√£o detectada' :
                        'Score diminuiu - sistema antigo estava sendo generoso demais'
                    }</p>
                </div>
            `;
        }

        // Log inicial
        console.log('üéØ Teste de Compara√ß√£o de Scores carregado');
        console.log('üìù Use runComparison() para testar um arquivo');
    </script>
</body>
</html>
