<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåê VERIFICA√á√ÉO DEPLOY VERCEL - Sistema Completo</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #00ff41;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(17, 17, 17, 0.9);
            border: 3px solid #00ff41;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 0 40px rgba(0, 255, 65, 0.3);
            backdrop-filter: blur(10px);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #00ff41;
            padding-bottom: 20px;
        }
        .header h1 {
            font-size: 2.5em;
            margin: 0;
            text-shadow: 0 0 20px rgba(0, 255, 65, 0.8);
        }
        .status-card {
            background: rgba(0, 51, 0, 0.8);
            border: 2px solid #00ff41;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        .status-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 255, 65, 0.2);
        }
        .status-loading {
            background: rgba(51, 51, 0, 0.8);
            border-color: #ffff00;
        }
        .status-error {
            background: rgba(51, 0, 0, 0.8);
            border-color: #ff3333;
        }
        .results {
            background: rgba(0, 0, 0, 0.9);
            color: #00ff41;
            padding: 25px;
            margin: 20px 0;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 600px;
            overflow-y: auto;
            border: 1px solid #333;
            box-shadow: inset 0 0 20px rgba(0, 255, 65, 0.1);
        }
        button {
            background: linear-gradient(45deg, #00ff41, #00cc33);
            color: #000;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        button:hover {
            background: linear-gradient(45deg, #00cc33, #00aa22);
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(0, 255, 65, 0.4);
        }
        button:active {
            transform: scale(0.95);
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(0, 255, 65, 0.3);
        }
        .metric:last-child {
            border-bottom: none;
        }
        .status-icon {
            font-size: 1.2em;
            margin-right: 10px;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff41, #00cc33);
            width: 0%;
            transition: width 0.5s ease;
        }
        .blink {
            animation: blink 1s infinite;
        }
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåê VERIFICA√á√ÉO DEPLOY VERCEL</h1>
            <h2>Sistema de An√°lise de Mixagem - Status Completo</h2>
            <p id="url-info">üìç URL: <span id="current-url"></span></p>
        </div>

        <div id="status-general" class="status-card status-loading">
            <h3><span class="blink">‚è≥</span> INICIANDO VERIFICA√á√ÉO COMPLETA...</h3>
            <div class="progress-bar">
                <div id="progress-fill" class="progress-fill"></div>
            </div>
            <p id="status-text">Carregando sistemas de verifica√ß√£o...</p>
        </div>

        <div class="grid">
            <div class="status-card">
                <h3>üìÅ ARQUIVOS ESSENCIAIS</h3>
                <div id="arquivos-status">
                    <div class="metric">
                        <span>sistema-completo-teste.html</span>
                        <span id="arquivo-sistema">‚è≥</span>
                    </div>
                    <div class="metric">
                        <span>scoring.js (ES6)</span>
                        <span id="arquivo-scoring">‚è≥</span>
                    </div>
                    <div class="metric">
                        <span>embedded-refs-new.js</span>
                        <span id="arquivo-refs">‚è≥</span>
                    </div>
                    <div class="metric">
                        <span>audio-analyzer.js</span>
                        <span id="arquivo-analyzer">‚è≥</span>
                    </div>
                </div>
            </div>

            <div class="status-card">
                <h3>üîß M√ìDULOS FUNCIONAIS</h3>
                <div id="modulos-status">
                    <div class="metric">
                        <span>scoringModule</span>
                        <span id="modulo-scoring">‚è≥</span>
                    </div>
                    <div class="metric">
                        <span>AudioAnalyzer</span>
                        <span id="modulo-analyzer">‚è≥</span>
                    </div>
                    <div class="metric">
                        <span>PROD_AI_REF_DATA</span>
                        <span id="modulo-refs">‚è≥</span>
                    </div>
                    <div class="metric">
                        <span>Sistema Completo</span>
                        <span id="modulo-sistema">‚è≥</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="status-card">
            <h3>üåê VARI√ÅVEIS GLOBAIS</h3>
            <div id="variaveis-status" class="grid">
                <div class="metric">
                    <span>USE_TT_DR</span>
                    <span id="var-ttdr">‚è≥</span>
                </div>
                <div class="metric">
                    <span>SCORING_V2</span>
                    <span id="var-scoring">‚è≥</span>
                </div>
                <div class="metric">
                    <span>AUDIT_MODE</span>
                    <span id="var-audit">‚è≥</span>
                </div>
                <div class="metric">
                    <span>PROD_AI_REF_GENRE</span>
                    <span id="var-genre">‚è≥</span>
                </div>
            </div>
        </div>

        <div class="status-card">
            <h3>üéØ A√á√ïES DISPON√çVEIS</h3>
            <div class="grid">
                <button onclick="executarVerificacaoCompleta()">
                    üöÄ Verifica√ß√£o Completa
                </button>
                <button onclick="testarSistema()">
                    üß™ Testar Sistema
                </button>
                <button onclick="abrirSistemaCompleto()">
                    üîß Sistema Completo
                </button>
                <button onclick="limparCache()">
                    üóëÔ∏è Limpar Cache
                </button>
            </div>
        </div>

        <div class="results">
            <div id="resultados">
üåê VERIFICA√á√ÉO DEPLOY VERCEL
============================

Aguardando in√≠cio da verifica√ß√£o...

üìã CHECKLIST:
‚úÖ Arquivos no servidor
‚úÖ M√≥dulos carregando
‚úÖ Vari√°veis configuradas  
‚úÖ Sistema funcional

Clique em "Verifica√ß√£o Completa" para come√ßar.
            </div>
        </div>
    </div>

    <!-- Carregar script de verifica√ß√£o -->
    <script src="verificar-deploy-vercel.js"></script>
    
    <script>
        // Mostrar URL atual
        document.getElementById('current-url').textContent = window.location.href;
        
        let verificacaoEmAndamento = false;
        
        /**
         * Executar verifica√ß√£o completa
         */
        async function executarVerificacaoCompleta() {
            if (verificacaoEmAndamento) return;
            verificacaoEmAndamento = true;
            
            const output = document.getElementById('resultados');
            const statusGeneral = document.getElementById('status-general');
            const statusText = document.getElementById('status-text');
            const progressFill = document.getElementById('progress-fill');
            
            try {
                statusText.textContent = 'Executando verifica√ß√£o completa...';
                progressFill.style.width = '20%';
                
                output.innerHTML = 'üöÄ INICIANDO VERIFICA√á√ÉO COMPLETA DO DEPLOY VERCEL\n' + 
                                 '='.repeat(60) + '\n\n';
                
                // Verificar se fun√ß√£o est√° dispon√≠vel
                if (typeof window.verificarDeployVercel !== 'function') {
                    throw new Error('Script de verifica√ß√£o n√£o carregado');
                }
                
                progressFill.style.width = '40%';
                statusText.textContent = 'Analisando arquivos e m√≥dulos...';
                
                // Executar verifica√ß√£o
                const resultado = await window.verificarDeployVercel();
                
                progressFill.style.width = '80%';
                statusText.textContent = 'Processando resultados...';
                
                // Atualizar interface com resultados
                atualizarInterface(resultado);
                
                // Formatar resultado no output
                let relatorio = 'üî¨ VERIFICA√á√ÉO COMPLETA EXECUTADA\n';
                relatorio += '='.repeat(60) + '\n\n';
                
                relatorio += 'üìÖ Timestamp: ' + resultado.timestamp + '\n';
                relatorio += 'üåê URL: ' + resultado.url + '\n\n';
                
                // Resumo geral
                const arquivosOk = Object.values(resultado.arquivos).every(a => a.exists);
                const modulosOk = Object.values(resultado.modulos).every(m => m);
                const variaveisOk = resultado.variaveis.USE_TT_DR && resultado.variaveis.SCORING_V2;
                
                relatorio += 'üìä RESUMO GERAL:\n';
                relatorio += `Arquivos: ${arquivosOk ? '‚úÖ' : '‚ùå'} (${Object.keys(resultado.arquivos).length} verificados)\n`;
                relatorio += `M√≥dulos: ${modulosOk ? '‚úÖ' : '‚ùå'} (${Object.keys(resultado.modulos).length} testados)\n`;
                relatorio += `Vari√°veis: ${variaveisOk ? '‚úÖ' : '‚ùå'} (configura√ß√£o global)\n\n`;
                
                relatorio += 'üèÅ CONCLUS√ÉO: ' + resultado.conclusao + '\n\n';
                
                if (arquivosOk && modulosOk && variaveisOk) {
                    relatorio += 'üéâ SISTEMA COMPLETAMENTE OPERACIONAL!\n';
                    relatorio += 'üéØ Deploy na Vercel executado com sucesso\n';
                    relatorio += 'üéµ Todas as corre√ß√µes do sistema de an√°lise foram aplicadas\n';
                    relatorio += '‚úÖ Pode usar o sistema de an√°lise de mixagem normalmente\n\n';
                    relatorio += 'üîó LINKS √öTEIS:\n';
                    relatorio += '   - Sistema Completo: ./sistema-completo-teste.html\n';
                    relatorio += '   - Investiga√ß√£o: ./investigacao-critica.html\n';
                    relatorio += '   - Diagn√≥stico: ./diagnostico-score-critico.html\n';
                    
                    statusGeneral.className = 'status-card';
                    statusGeneral.innerHTML = '<h3>‚úÖ DEPLOY VERCEL COMPLETAMENTE FUNCIONAL!</h3><p>Todas as corre√ß√µes aplicadas com sucesso</p>';
                } else {
                    relatorio += '‚ö†Ô∏è ALGUNS PROBLEMAS IDENTIFICADOS:\n';
                    if (!arquivosOk) relatorio += '   - Alguns arquivos n√£o foram encontrados\n';
                    if (!modulosOk) relatorio += '   - Alguns m√≥dulos t√™m problemas\n';
                    if (!variaveisOk) relatorio += '   - Vari√°veis globais n√£o configuradas\n';
                    relatorio += '\nVerifique os logs detalhados acima.\n';
                    
                    statusGeneral.className = 'status-card status-error';
                    statusGeneral.innerHTML = '<h3>‚ö†Ô∏è DEPLOY PARCIALMENTE FUNCIONAL</h3><p>Alguns problemas encontrados</p>';
                }
                
                progressFill.style.width = '100%';
                statusText.textContent = 'Verifica√ß√£o completa!';
                
                output.innerHTML = relatorio;
                
            } catch (error) {
                output.innerHTML = '‚ùå ERRO na verifica√ß√£o: ' + error.message + '\n\n' +
                    'Poss√≠veis causas:\n' +
                    '1. Script de verifica√ß√£o n√£o carregou\n' +
                    '2. Conex√£o com servidor inst√°vel\n' +
                    '3. Deploy ainda em andamento\n\n' +
                    'Aguarde alguns minutos e tente novamente.';
                
                statusGeneral.className = 'status-card status-error';
                statusGeneral.innerHTML = '<h3>‚ùå ERRO NA VERIFICA√á√ÉO</h3><p>' + error.message + '</p>';
                
                console.error('Erro na verifica√ß√£o:', error);
            } finally {
                verificacaoEmAndamento = false;
            }
        }
        
        /**
         * Atualizar interface com resultados
         */
        function atualizarInterface(resultado) {
            // Atualizar status dos arquivos
            const arquivos = {
                'arquivo-sistema': resultado.arquivos['sistema-completo-teste.html']?.exists,
                'arquivo-scoring': resultado.arquivos['lib/audio/features/scoring.js']?.exists,
                'arquivo-refs': resultado.arquivos['public/refs/embedded-refs-new.js']?.exists,
                'arquivo-analyzer': resultado.arquivos['public/audio-analyzer.js']?.exists
            };
            
            Object.entries(arquivos).forEach(([id, status]) => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = status ? '‚úÖ' : '‚ùå';
                }
            });
            
            // Atualizar status dos m√≥dulos
            const modulos = {
                'modulo-scoring': resultado.modulos.scoringModule,
                'modulo-analyzer': resultado.modulos.audioAnalyzer,
                'modulo-refs': resultado.modulos.refData,
                'modulo-sistema': resultado.modulos.sistemaCompleto
            };
            
            Object.entries(modulos).forEach(([id, status]) => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = status ? '‚úÖ' : '‚ùå';
                }
            });
            
            // Atualizar vari√°veis globais
            const variaveis = {
                'var-ttdr': resultado.variaveis.USE_TT_DR,
                'var-scoring': resultado.variaveis.SCORING_V2,
                'var-audit': resultado.variaveis.AUDIT_MODE,
                'var-genre': resultado.variaveis.PROD_AI_REF_GENRE
            };
            
            Object.entries(variaveis).forEach(([id, valor]) => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = valor ? '‚úÖ' : '‚ùå';
                }
            });
        }
        
        /**
         * Testar sistema b√°sico
         */
        function testarSistema() {
            const output = document.getElementById('resultados');
            output.innerHTML = 'üß™ TESTE B√ÅSICO DO SISTEMA\n' + '='.repeat(40) + '\n\n';
            
            try {
                // Verificar m√≥dulos b√°sicos
                output.innerHTML += 'Verificando m√≥dulos essenciais...\n';
                output.innerHTML += `scoringModule: ${typeof window.scoringModule !== 'undefined' ? '‚úÖ' : '‚ùå'}\n`;
                output.innerHTML += `AudioAnalyzer: ${typeof window.AudioAnalyzer !== 'undefined' ? '‚úÖ' : '‚ùå'}\n`;
                output.innerHTML += `PROD_AI_REF_DATA: ${typeof window.PROD_AI_REF_DATA !== 'undefined' ? '‚úÖ' : '‚ùå'}\n\n`;
                
                if (typeof window.scoringModule !== 'undefined' && 
                    typeof window.AudioAnalyzer !== 'undefined') {
                    output.innerHTML += '‚úÖ Sistema b√°sico funcional!\n';
                    output.innerHTML += 'Pronto para an√°lises de √°udio.\n';
                } else {
                    output.innerHTML += '‚ùå Sistema b√°sico com problemas.\n';
                    output.innerHTML += 'Execute verifica√ß√£o completa para diagn√≥stico.\n';
                }
                
            } catch (error) {
                output.innerHTML += '‚ùå Erro no teste: ' + error.message;
            }
        }
        
        /**
         * Abrir sistema completo
         */
        function abrirSistemaCompleto() {
            window.open('sistema-completo-teste.html', '_blank');
        }
        
        /**
         * Limpar cache
         */
        function limparCache() {
            const timestamp = Date.now();
            const output = document.getElementById('resultados');
            
            output.innerHTML = 'üóëÔ∏è LIMPANDO CACHE\n' + '='.repeat(30) + '\n\n';
            output.innerHTML += 'Cache busting timestamp: ' + timestamp + '\n';
            output.innerHTML += 'Recarregando p√°gina em 3 segundos...\n';
            
            setTimeout(() => {
                window.location.href = window.location.href.split('?')[0] + '?t=' + timestamp;
            }, 3000);
        }
        
        // Auto-executar verifica√ß√£o ao carregar
        window.addEventListener('load', () => {
            console.log('üåê P√°gina de verifica√ß√£o do deploy carregada');
            
            // Auto-executar ap√≥s 2 segundos
            setTimeout(() => {
                console.log('üöÄ Executando verifica√ß√£o autom√°tica...');
                executarVerificacaoCompleta();
            }, 2000);
        });
    </script>
</body>
</html>
