<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Score Calculation</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a1a2e; color: #fff; }
        .test-case { background: #16213e; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .score { font-weight: bold; font-size: 18px; margin: 10px 0; }
        .breakdown { margin: 10px 0; font-size: 14px; }
        .expected { color: #4CAF50; }
        .actual { color: #ff9800; }
        .error { color: #f44336; }
    </style>
</head>
<body>
    <h1>üîç Debug Score Calculation</h1>
    
    <div id="results"></div>

    <script>
        // Simular os pesos e c√°lculo do temp-v2.js
        function calculateScore(scores, stereo = true) {
            const weights = {
                dynamics: 0.25,
                frequency: 0.20,
                stereo: stereo ? 0.20 : 0,
                loudness: 0.20,
                technical: 0.15
            };
            
            if (!stereo) {
                weights.dynamics = 0.30;
                weights.frequency = 0.25;
                weights.loudness = 0.25;
                weights.technical = 0.20;
            }
            
            const overall = Math.round(
                scores.dynamics * weights.dynamics +
                scores.frequency * weights.frequency +
                scores.stereo * weights.stereo +
                scores.loudness * weights.loudness +
                scores.technical * weights.technical
            );
            
            return Math.max(0, Math.min(100, overall));
        }

        // Teste casos espec√≠ficos
        const testCases = [
            {
                name: "Caso Problema: 3 verde, 1 amarelo, 8 vermelho",
                scores: { dynamics: 15, frequency: 10, stereo: 85, loudness: 13, technical: 75 }, // Supondo valores baixos
                expectedRange: "20-35",
                description: "Se tem 8 vermelhos (scores baixos), deveria dar score baixo"
            },
            {
                name: "Caso Extremo: Todos vermelhos",
                scores: { dynamics: 5, frequency: 5, stereo: 5, loudness: 5, technical: 5 },
                expectedRange: "5-10",
                description: "Todos scores baixos = score geral baixo"
            },
            {
                name: "Caso Balanceado",
                scores: { dynamics: 50, frequency: 50, stereo: 50, loudness: 50, technical: 50 },
                expectedRange: "50",
                description: "Scores m√©dios = score m√©dio"
            },
            {
                name: "Caso Excelente",
                scores: { dynamics: 95, frequency: 95, stereo: 95, loudness: 95, technical: 95 },
                expectedRange: "95",
                description: "Scores altos = score alto"
            },
            {
                name: "Caso Real Problema",
                scores: { dynamics: 75, frequency: 85, stereo: 90, loudness: 13, technical: 40 },
                expectedRange: "50-60",
                description: "Poucos verdes, muitos vermelhos"
            }
        ];

        const resultsDiv = document.getElementById('results');

        testCases.forEach((testCase, index) => {
            const actualScore = calculateScore(testCase.scores);
            
            // Verificar se est√° no range esperado
            let isCorrect = false;
            if (testCase.expectedRange.includes('-')) {
                const [min, max] = testCase.expectedRange.split('-').map(Number);
                isCorrect = actualScore >= min && actualScore <= max;
            } else {
                isCorrect = actualScore == testCase.expectedRange;
            }
            
            const testDiv = document.createElement('div');
            testDiv.className = 'test-case';
            testDiv.innerHTML = `
                <h3>Teste ${index + 1}: ${testCase.name}</h3>
                <div class="breakdown">
                    <strong>Sub-scores:</strong><br>
                    Dynamics: ${testCase.scores.dynamics}/100<br>
                    Frequency: ${testCase.scores.frequency}/100<br>
                    Stereo: ${testCase.scores.stereo}/100<br>
                    Loudness: ${testCase.scores.loudness}/100<br>
                    Technical: ${testCase.scores.technical}/100
                </div>
                <div class="score expected">Esperado: ${testCase.expectedRange}</div>
                <div class="score actual">Calculado: ${actualScore}/100</div>
                <div class="${isCorrect ? 'expected' : 'error'}">
                    ${isCorrect ? '‚úÖ CORRETO' : '‚ùå INCONSISTENTE'}
                </div>
                <div class="breakdown">${testCase.description}</div>
                
                <details>
                    <summary>C√°lculo Detalhado</summary>
                    <div style="font-family: monospace; font-size: 12px; margin: 10px 0;">
                        Dynamics: ${testCase.scores.dynamics} √ó 0.25 = ${(testCase.scores.dynamics * 0.25).toFixed(2)}<br>
                        Frequency: ${testCase.scores.frequency} √ó 0.20 = ${(testCase.scores.frequency * 0.20).toFixed(2)}<br>
                        Stereo: ${testCase.scores.stereo} √ó 0.20 = ${(testCase.scores.stereo * 0.20).toFixed(2)}<br>
                        Loudness: ${testCase.scores.loudness} √ó 0.20 = ${(testCase.scores.loudness * 0.20).toFixed(2)}<br>
                        Technical: ${testCase.scores.technical} √ó 0.15 = ${(testCase.scores.technical * 0.15).toFixed(2)}<br>
                        <strong>Total: ${actualScore}/100</strong>
                    </div>
                </details>
            `;
            
            resultsDiv.appendChild(testDiv);
        });

        // An√°lise adicional
        const analysisDiv = document.createElement('div');
        analysisDiv.className = 'test-case';
        analysisDiv.innerHTML = `
            <h3>üîç An√°lise do Problema</h3>
            <p>Se voc√™ est√° vendo 3 verde, 1 amarelo e 8 vermelho mas o score √© 50, isso indica:</p>
            <ul>
                <li><strong>Problema 1:</strong> Os pesos podem estar favorecendo categorias espec√≠ficas</li>
                <li><strong>Problema 2:</strong> Pode haver dois sistemas de c√°lculo diferentes (legacy vs novo)</li>
                <li><strong>Problema 3:</strong> O "verde/amarelo/vermelho" pode n√£o corresponder aos valores reais</li>
            </ul>
            
            <h4>Verifica√ß√£o dos Pesos:</h4>
            <div style="font-family: monospace; font-size: 14px;">
                Dynamics: 25%<br>
                Frequency: 20%<br>
                Stereo: 20%<br>
                Loudness: 20%<br>
                Technical: 15%<br>
                <strong>Total: 100%</strong>
            </div>
        `;
        
        resultsDiv.appendChild(analysisDiv);
    </script>
</body>
</html>
